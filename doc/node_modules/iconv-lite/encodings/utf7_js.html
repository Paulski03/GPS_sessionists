<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>utf7.js - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../../";
  var index_rel_prefix = "../../../";
</script>

<script src="../../../js/jquery.js"></script>
<script src="../../../js/darkfish.js"></script>

<link href="../../../css/fonts.css" rel="stylesheet">
<link href="../../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../../table_of_contents.html#pages">Pages</a>
    <a href="../../../table_of_contents.html#classes">Classes</a>
    <a href="../../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../../Gemfile.html">Gemfile</a>
  
    <li><a href="../../../Gemfile_lock.html">Gemfile.lock</a>
  
    <li><a href="../../../README_md.html">README</a>
  
    <li><a href="../../../Rakefile.html">Rakefile</a>
  
    <li><a href="../../../app/assets/config/manifest_js.html">manifest.js</a>
  
    <li><a href="../../../app/assets/javascripts/application_js.html">application.js</a>
  
    <li><a href="../../../app/assets/javascripts/cable_js.html">cable.js</a>
  
    <li><a href="../../../app/assets/javascripts/pages_coffee.html">pages.coffee</a>
  
    <li><a href="../../../app/assets/stylesheets/application_css_scss.html">application.css.scss</a>
  
    <li><a href="../../../app/assets/stylesheets/custom_css_scss.html">custom.css.scss</a>
  
    <li><a href="../../../app/assets/stylesheets/pages_scss.html">pages.scss</a>
  
    <li><a href="../../../config_ru.html">config.ru</a>
  
    <li><a href="../../../log/development_log.html">development.log</a>
  
    <li><a href="../../../node_modules/addressparser/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../../node_modules/addressparser/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/addressparser/README_md.html">README</a>
  
    <li><a href="../../../node_modules/addressparser/lib/addressparser_js.html">addressparser.js</a>
  
    <li><a href="../../../node_modules/addressparser/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_ensureasync/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_ensureasync/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_ensureasync/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_queue/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_queue/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_queue/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_arrayeach/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_arrayeach/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_arrayeach/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_ensureasync/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_ensureasync/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_ensureasync/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_isarray/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_isarray/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_isarray/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_map/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_map/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_map/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_noop/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_noop/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_noop/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_onlyonce/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_onlyonce/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_onlyonce/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_queue/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_queue/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_queue/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_restparam/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_restparam/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_restparam/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_setimmediate/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_setimmediate/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_setimmediate/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/bottleneck/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/bottleneck/README_md.html">README</a>
  
    <li><a href="../../../node_modules/bottleneck/bottleneck_d_ts_ejs.html">bottleneck.d.ts.ejs</a>
  
    <li><a href="../../../node_modules/bottleneck/bottleneck_js.html">bottleneck.js</a>
  
    <li><a href="../../../node_modules/bottleneck/bottleneck_min_js.html">bottleneck.min.js</a>
  
    <li><a href="../../../node_modules/bottleneck/bower_json.html">bower.json</a>
  
    <li><a href="../../../node_modules/bottleneck/lib/Bottleneck_js.html">Bottleneck.js</a>
  
    <li><a href="../../../node_modules/bottleneck/lib/Cluster_js.html">Cluster.js</a>
  
    <li><a href="../../../node_modules/bottleneck/lib/DLList_js.html">DLList.js</a>
  
    <li><a href="../../../node_modules/bottleneck/lib/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/bottleneck/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/bottleneck/scripts/build_sh.html">build.sh</a>
  
    <li><a href="../../../node_modules/bottleneck/src/Bottleneck_coffee.html">Bottleneck.coffee</a>
  
    <li><a href="../../../node_modules/bottleneck/src/Cluster_coffee.html">Cluster.coffee</a>
  
    <li><a href="../../../node_modules/bottleneck/src/DLList_coffee.html">DLList.coffee</a>
  
    <li><a href="../../../node_modules/bottleneck/src/index_coffee.html">index.coffee</a>
  
    <li><a href="../../../node_modules/bottleneck/test_ts.html">test.ts</a>
  
    <li><a href="../../../node_modules/bottleneck/test/DLList_js.html">DLList.js</a>
  
    <li><a href="../../../node_modules/bottleneck/test/general_js.html">general.js</a>
  
    <li><a href="../../../node_modules/bottleneck/test/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/bottleneck/test/priority_js.html">priority.js</a>
  
    <li><a href="../../../node_modules/bottleneck/test/promises_js.html">promises.js</a>
  
    <li><a href="../../../node_modules/debug/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../../node_modules/debug/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/debug/Makefile.html">Makefile</a>
  
    <li><a href="../../../node_modules/debug/README_md.html">README</a>
  
    <li><a href="../../../node_modules/debug/component_json.html">component.json</a>
  
    <li><a href="../../../node_modules/debug/karma_conf_js.html">karma.conf.js</a>
  
    <li><a href="../../../node_modules/debug/node_js.html">node.js</a>
  
    <li><a href="../../../node_modules/debug/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/debug/src/browser_js.html">browser.js</a>
  
    <li><a href="../../../node_modules/debug/src/debug_js.html">debug.js</a>
  
    <li><a href="../../../node_modules/debug/src/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/debug/src/node_js.html">node.js</a>
  
    <li><a href="../../../node_modules/encoding/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/encoding/README_md.html">README</a>
  
    <li><a href="../../../node_modules/encoding/lib/encoding_js.html">encoding.js</a>
  
    <li><a href="../../../node_modules/encoding/lib/iconv-loader_js.html">iconv-loader.js</a>
  
    <li><a href="../../../node_modules/encoding/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/encoding/test/test_js.html">test.js</a>
  
    <li><a href="../../../node_modules/extend/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../../node_modules/extend/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/extend/README_md.html">README</a>
  
    <li><a href="../../../node_modules/extend/component_json.html">component.json</a>
  
    <li><a href="../../../node_modules/extend/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/extend/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/Changelog_md.html">Changelog</a>
  
    <li><a href="../../../node_modules/iconv-lite/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/iconv-lite/README_md.html">README</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/dbcs-codec_js.html">dbcs-codec.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/dbcs-data_js.html">dbcs-data.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/internal_js.html">internal.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/sbcs-codec_js.html">sbcs-codec.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/sbcs-data-generated_js.html">sbcs-data-generated.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/sbcs-data_js.html">sbcs-data.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/big5-added_json.html">big5-added.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/cp936_json.html">cp936.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/cp949_json.html">cp949.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/cp950_json.html">cp950.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/eucjp_json.html">eucjp.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/gb18030-ranges_json.html">gb18030-ranges.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/gbk-added_json.html">gbk-added.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/shiftjis_json.html">shiftjis.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/utf16_js.html">utf16.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/utf7_js.html">utf7.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/lib/bom-handling_js.html">bom-handling.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/lib/extend-node_js.html">extend-node.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/lib/index_d_ts.html">index.d.ts</a>
  
    <li><a href="../../../node_modules/iconv-lite/lib/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/lib/streams_js.html">streams.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/lodash_chunk/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/lodash_chunk/README_md.html">README</a>
  
    <li><a href="../../../node_modules/lodash_chunk/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/lodash_chunk/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/mailparser/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/mailparser/README_md.html">README</a>
  
    <li><a href="../../../node_modules/mailparser/lib/datetime_js.html">datetime.js</a>
  
    <li><a href="../../../node_modules/mailparser/lib/mailparser_js.html">mailparser.js</a>
  
    <li><a href="../../../node_modules/mailparser/lib/streams_js.html">streams.js</a>
  
    <li><a href="../../../node_modules/mailparser/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/mailparser/test/mailparser_js.html">mailparser.js</a>
  
    <li><a href="../../../node_modules/mailparser/test/mixed_eml.html">mixed.eml</a>
  
    <li><a href="../../../node_modules/mailparser/test/nested_eml.html">nested.eml</a>
  
    <li><a href="../../../node_modules/mime/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/mime/README_md.html">README</a>
  
    <li><a href="../../../node_modules/mime/build/build_js.html">build.js</a>
  
    <li><a href="../../../node_modules/mime/build/test_js.html">test.js</a>
  
    <li><a href="../../../node_modules/mime/cli_js.html">cli.js</a>
  
    <li><a href="../../../node_modules/mime/mime_js.html">mime.js</a>
  
    <li><a href="../../../node_modules/mime/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/mime/types_json.html">types.json</a>
  
    <li><a href="../../../node_modules/mimelib/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/mimelib/README_md.html">README</a>
  
    <li><a href="../../../node_modules/mimelib/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/mimelib/lib/content-types-reversed_js.html">content-types-reversed.js</a>
  
    <li><a href="../../../node_modules/mimelib/lib/content-types_js.html">content-types.js</a>
  
    <li><a href="../../../node_modules/mimelib/lib/mimelib_js.html">mimelib.js</a>
  
    <li><a href="../../../node_modules/mimelib/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/ms/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/ms/license_md.html">license</a>
  
    <li><a href="../../../node_modules/ms/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/ms/readme_md.html">readme</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/CONTRIBUTING_md.html">CONTRIBUTING</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/LICENSE_txt.html">LICENSE</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/README_md.html">README</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/examples/example_js.html">example.js</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/lib/client_js.html">client.js</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/test/test_js.html">test.js</a>
  
    <li><a href="../../../node_modules/sendgrid/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../../node_modules/sendgrid/CONTRIBUTING_md.html">CONTRIBUTING</a>
  
    <li><a href="../../../node_modules/sendgrid/LICENSE_txt.html">LICENSE</a>
  
    <li><a href="../../../node_modules/sendgrid/README_md.html">README</a>
  
    <li><a href="../../../node_modules/sendgrid/TROUBLESHOOTING_md.html">TROUBLESHOOTING</a>
  
    <li><a href="../../../node_modules/sendgrid/USAGE_md.html">USAGE</a>
  
    <li><a href="../../../node_modules/sendgrid/USE_CASES_md.html">USE_CASES</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/accesssettings/accesssettings_js.html">accesssettings.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/alerts/alerts_js.html">alerts.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/apikeys/apikeys_js.html">apikeys.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/asm/asm_js.html">asm.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/browsers/browsers_js.html">browsers.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/campaigns/campaigns_js.html">campaigns.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/categories/categories_js.html">categories.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/clients/clients_js.html">clients.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/contactdb/contactdb_js.html">contactdb.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/devices/devices_js.html">devices.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/geo/geo_js.html">geo.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/helpers/mail/example_js.html">example.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/ips/ips_js.html">ips.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/mail/mail_js.html">mail.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/mailboxproviders/mailboxproviders_js.html">mailboxproviders.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/mailsettings/mailsettings_js.html">mailsettings.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/partnersettings/partnersettings_js.html">partnersettings.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/scopes/scopes_js.html">scopes.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/senders/senders_js.html">senders.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/stats/stats_js.html">stats.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/subusers/subusers_js.html">subusers.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/suppression/suppression_js.html">suppression.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/templates/templates_js.html">templates.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/trackingsettings/trackingsettings_js.html">trackingsettings.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/user/user_js.html">user.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/whitelabel/whitelabel_js.html">whitelabel.js</a>
  
    <li><a href="../../../node_modules/sendgrid/index_d_ts.html">index.d.ts</a>
  
    <li><a href="../../../node_modules/sendgrid/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/sendgrid/lib/helpers/contact-importer/contact-importer_js.html">contact-importer.js</a>
  
    <li><a href="../../../node_modules/sendgrid/lib/helpers/error_js.html">error.js</a>
  
    <li><a href="../../../node_modules/sendgrid/lib/helpers/inbound/parse_js.html">parse.js</a>
  
    <li><a href="../../../node_modules/sendgrid/lib/helpers/mail/README_md.html">README</a>
  
    <li><a href="../../../node_modules/sendgrid/lib/helpers/mail/mail_js.html">mail.js</a>
  
    <li><a href="../../../node_modules/sendgrid/lib/sendgrid_js.html">sendgrid.js</a>
  
    <li><a href="../../../node_modules/sendgrid/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/sendgrid/test/helpers/contact-importer/contact-importer_test_js.html">contact-importer.test.js</a>
  
    <li><a href="../../../node_modules/sendgrid/test/helpers/inbound/parse_test_js.html">parse.test.js</a>
  
    <li><a href="../../../node_modules/sendgrid/test/helpers/mail/test_js.html">test.js</a>
  
    <li><a href="../../../node_modules/sendgrid/test/prism_sh.html">prism.sh</a>
  
    <li><a href="../../../node_modules/sendgrid/test/test_js.html">test.js</a>
  
    <li><a href="../../../node_modules/sendgrid/tsconfig_json.html">tsconfig.json</a>
  
    <li><a href="../../../node_modules/uue/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/uue/README_md.html">README</a>
  
    <li><a href="../../../node_modules/uue/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/uue/uue_js.html">uue.js</a>
  
    <li><a href="../../../package-lock_json.html">package-lock.json</a>
  
    <li><a href="../../../package_json.html">package.json</a>
  
    <li><a href="../../../public/404_html.html">404.html</a>
  
    <li><a href="../../../public/422_html.html">422.html</a>
  
    <li><a href="../../../public/500_html.html">500.html</a>
  
    <li><a href="../../../public/apple-touch-icon-precomposed_png.html">apple-touch-icon-precomposed.png</a>
  
    <li><a href="../../../public/apple-touch-icon_png.html">apple-touch-icon.png</a>
  
    <li><a href="../../../public/favicon_ico.html">favicon.ico</a>
  
    <li><a href="../../../public/robots_txt.html">robots</a>
  
    <li><a href="../../../tmp/pids/server_pid.html">server.pid</a>
  
    <li><a href="../../../tmp/restart_txt.html">restart</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page node_modules/iconv-lite/encodings/utf7.js">

<p>“use strict”; var Buffer = require(“buffer”).Buffer;</p>

<p>// UTF-7 codec, according to <a
href="https://tools.ietf.org/html/rfc2152">tools.ietf.org/html/rfc2152</a>
// See also below a UTF-7-IMAP codec, according to <a
href="http://tools.ietf.org/html/rfc3501#section-5.1.3">tools.ietf.org/html/rfc3501#section-5.1.3</a></p>

<p>exports.utf7 = Utf7Codec; exports.unicode11utf7 = &#39;utf7&#39;; // Alias
UNICODE-1-1-UTF-7 function Utf7Codec(codecOptions, iconv) {</p>

<pre class="ruby"><span class="ruby-identifier">this</span>.<span class="ruby-identifier">iconv</span> = <span class="ruby-identifier">iconv</span>;
</pre>

<p>};</p>

<p>Utf7Codec.prototype.encoder = Utf7Encoder; Utf7Codec.prototype.decoder =
Utf7Decoder; Utf7Codec.prototype.bomAware = true;</p>

<p>// – Encoding</p>

<p>var nonDirectChars = /[^A-Za-z0-9&#39;(),-./:? nrt]+/g;</p>

<p>function Utf7Encoder(options, codec) {</p>

<pre class="ruby"><span class="ruby-identifier">this</span>.<span class="ruby-identifier">iconv</span> = <span class="ruby-identifier">codec</span>.<span class="ruby-identifier">iconv</span>;
</pre>

<p>}</p>

<p>Utf7Encoder.prototype.write = function(str) {</p>

<pre>// Naive implementation.
// Non-direct chars are encoded as &quot;+&lt;base64&gt;-&quot;; single &quot;+&quot; char is encoded as &quot;+-&quot;.
return new Buffer(str.replace(nonDirectChars, function(chunk) {
    return &quot;+&quot; + (chunk === &#39;+&#39; ? &#39;&#39; : 
        this.iconv.encode(chunk, &#39;utf16-be&#39;).toString(&#39;base64&#39;).replace(/=+$/, &#39;&#39;)) 
        + &quot;-&quot;;
}.bind(this)));</pre>

<p>}</p>

<p>Utf7Encoder.prototype.end = function() { }</p>

<p>// – Decoding</p>

<p>function Utf7Decoder(options, codec) {</p>

<pre class="ruby"><span class="ruby-identifier">this</span>.<span class="ruby-identifier">iconv</span> = <span class="ruby-identifier">codec</span>.<span class="ruby-identifier">iconv</span>;
<span class="ruby-identifier">this</span>.<span class="ruby-identifier">inBase64</span> = <span class="ruby-keyword">false</span>;
<span class="ruby-identifier">this</span>.<span class="ruby-identifier">base64Accum</span> = <span class="ruby-string">&#39;&#39;</span>;
</pre>

<p>}</p>

<p>var base64Regex = /[A-Za-z0-9/+]/; var base64Chars = []; for (var i = 0; i
&lt; 256; i++)</p>

<pre class="ruby"><span class="ruby-identifier">base64Chars</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">base64Regex</span>.<span class="ruby-identifier">test</span>(<span class="ruby-constant">String</span>.<span class="ruby-identifier">fromCharCode</span>(<span class="ruby-identifier">i</span>));
</pre>

<p>var plusChar = &#39;+&#39;.charCodeAt(0),</p>

<pre class="ruby"><span class="ruby-identifier">minusChar</span> = <span class="ruby-string">&#39;-&#39;</span>.<span class="ruby-identifier">charCodeAt</span>(<span class="ruby-value">0</span>),
<span class="ruby-identifier">andChar</span> = <span class="ruby-string">&#39;&amp;&#39;</span>.<span class="ruby-identifier">charCodeAt</span>(<span class="ruby-value">0</span>);
</pre>

<p>Utf7Decoder.prototype.write = function(buf) {</p>

<pre>var res = &quot;&quot;, lastI = 0,
    inBase64 = this.inBase64,
    base64Accum = this.base64Accum;

// The decoder is more involved as we must handle chunks in stream.

for (var i = 0; i &lt; buf.length; i++) {
    if (!inBase64) { // We&#39;re in direct mode.
        // Write direct chars until &#39;+&#39;
        if (buf[i] == plusChar) {
            res += this.iconv.decode(buf.slice(lastI, i), &quot;ascii&quot;); // Write direct chars.
            lastI = i+1;
            inBase64 = true;
        }
    } else { // We decode base64.
        if (!base64Chars[buf[i]]) { // Base64 ended.
            if (i == lastI &amp;&amp; buf[i] == minusChar) {// &quot;+-&quot; -&gt; &quot;+&quot;
                res += &quot;+&quot;;
            } else {
                var b64str = base64Accum + buf.slice(lastI, i).toString();
                res += this.iconv.decode(new Buffer(b64str, &#39;base64&#39;), &quot;utf16-be&quot;);
            }

            if (buf[i] != minusChar) // Minus is absorbed after base64.
                i--;

            lastI = i+1;
            inBase64 = false;
            base64Accum = &#39;&#39;;
        }
    }
}

if (!inBase64) {
    res += this.iconv.decode(buf.slice(lastI), &quot;ascii&quot;); // Write direct chars.
} else {
    var b64str = base64Accum + buf.slice(lastI).toString();

    var canBeDecoded = b64str.length - (b64str.length % 8); // Minimal chunk: 2 quads -&gt; 2x3 bytes -&gt; 3 chars.
    base64Accum = b64str.slice(canBeDecoded); // The rest will be decoded in future.
    b64str = b64str.slice(0, canBeDecoded);

    res += this.iconv.decode(new Buffer(b64str, &#39;base64&#39;), &quot;utf16-be&quot;);
}

this.inBase64 = inBase64;
this.base64Accum = base64Accum;

return res;</pre>

<p>}</p>

<p>Utf7Decoder.prototype.end = function() {</p>

<pre>var res = &quot;&quot;;
if (this.inBase64 &amp;&amp; this.base64Accum.length &gt; 0)
    res = this.iconv.decode(new Buffer(this.base64Accum, &#39;base64&#39;), &quot;utf16-be&quot;);

this.inBase64 = false;
this.base64Accum = &#39;&#39;;
return res;</pre>

<p>}</p>

<p>// UTF-7-IMAP codec. // RFC3501 Sec. 5.1.3 Modified UTF-7 (<a
href="http://tools.ietf.org/html/rfc3501#section-5.1.3">tools.ietf.org/html/rfc3501#section-5.1.3</a>)
// Differences: //  * Base64 part is started by “&amp;” instead of “+” // 
* Direct characters are 0x20-0x7E, except “&amp;” (0x26) //  * In Base64,
“,” is used instead of “/” //  * Base64 must not be used to represent
direct characters. //  * No implicit shift back from Base64 (should always
end with &#39;-&#39;) //  * String must end in non-shifted position. //  *
“-&amp;” while in base64 is not allowed.</p>

<p>exports.utf7imap = Utf7IMAPCodec; function Utf7IMAPCodec(codecOptions,
iconv) {</p>

<pre class="ruby"><span class="ruby-identifier">this</span>.<span class="ruby-identifier">iconv</span> = <span class="ruby-identifier">iconv</span>;
</pre>

<p>};</p>

<p>Utf7IMAPCodec.prototype.encoder = Utf7IMAPEncoder;
Utf7IMAPCodec.prototype.decoder = Utf7IMAPDecoder;
Utf7IMAPCodec.prototype.bomAware = true;</p>

<p>// – Encoding</p>

<p>function Utf7IMAPEncoder(options, codec) {</p>

<pre class="ruby"><span class="ruby-identifier">this</span>.<span class="ruby-identifier">iconv</span> = <span class="ruby-identifier">codec</span>.<span class="ruby-identifier">iconv</span>;
<span class="ruby-identifier">this</span>.<span class="ruby-identifier">inBase64</span> = <span class="ruby-keyword">false</span>;
<span class="ruby-identifier">this</span>.<span class="ruby-identifier">base64Accum</span> = <span class="ruby-identifier">new</span> <span class="ruby-constant">Buffer</span>(<span class="ruby-value">6</span>);
<span class="ruby-identifier">this</span>.<span class="ruby-identifier">base64AccumIdx</span> = <span class="ruby-value">0</span>;
</pre>

<p>}</p>

<p>Utf7IMAPEncoder.prototype.write = function(str) {</p>

<pre>var inBase64 = this.inBase64,
    base64Accum = this.base64Accum,
    base64AccumIdx = this.base64AccumIdx,
    buf = new Buffer(str.length*5 + 10), bufIdx = 0;

for (var i = 0; i &lt; str.length; i++) {
    var uChar = str.charCodeAt(i);
    if (0x20 &lt;= uChar &amp;&amp; uChar &lt;= 0x7E) { // Direct character or &#39;&amp;&#39;.
        if (inBase64) {
            if (base64AccumIdx &gt; 0) {
                bufIdx += buf.write(base64Accum.slice(0, base64AccumIdx).toString(&#39;base64&#39;).replace(/\//g, &#39;,&#39;).replace(/=+$/, &#39;&#39;), bufIdx);
                base64AccumIdx = 0;
            }

            buf[bufIdx++] = minusChar; // Write &#39;-&#39;, then go to direct mode.
            inBase64 = false;
        }

        if (!inBase64) {
            buf[bufIdx++] = uChar; // Write direct character

            if (uChar === andChar)  // Ampersand -&gt; &#39;&amp;-&#39;
                buf[bufIdx++] = minusChar;
        }

    } else { // Non-direct character
        if (!inBase64) {
            buf[bufIdx++] = andChar; // Write &#39;&amp;&#39;, then go to base64 mode.
            inBase64 = true;
        }
        if (inBase64) {
            base64Accum[base64AccumIdx++] = uChar &gt;&gt; 8;
            base64Accum[base64AccumIdx++] = uChar &amp; 0xFF;

            if (base64AccumIdx == base64Accum.length) {
                bufIdx += buf.write(base64Accum.toString(&#39;base64&#39;).replace(/\//g, &#39;,&#39;), bufIdx);
                base64AccumIdx = 0;
            }
        }
    }
}

this.inBase64 = inBase64;
this.base64AccumIdx = base64AccumIdx;

return buf.slice(0, bufIdx);</pre>

<p>}</p>

<p>Utf7IMAPEncoder.prototype.end = function() {</p>

<pre>var buf = new Buffer(10), bufIdx = 0;
if (this.inBase64) {
    if (this.base64AccumIdx &gt; 0) {
        bufIdx += buf.write(this.base64Accum.slice(0, this.base64AccumIdx).toString(&#39;base64&#39;).replace(/\//g, &#39;,&#39;).replace(/=+$/, &#39;&#39;), bufIdx);
        this.base64AccumIdx = 0;
    }

    buf[bufIdx++] = minusChar; // Write &#39;-&#39;, then go to direct mode.
    this.inBase64 = false;
}

return buf.slice(0, bufIdx);</pre>

<p>}</p>

<p>// – Decoding</p>

<p>function Utf7IMAPDecoder(options, codec) {</p>

<pre class="ruby"><span class="ruby-identifier">this</span>.<span class="ruby-identifier">iconv</span> = <span class="ruby-identifier">codec</span>.<span class="ruby-identifier">iconv</span>;
<span class="ruby-identifier">this</span>.<span class="ruby-identifier">inBase64</span> = <span class="ruby-keyword">false</span>;
<span class="ruby-identifier">this</span>.<span class="ruby-identifier">base64Accum</span> = <span class="ruby-string">&#39;&#39;</span>;
</pre>

<p>}</p>

<p>var base64IMAPChars = base64Chars.slice(); <a
href="','.charCodeAt(0)">base64IMAPChars</a> = true;</p>

<p>Utf7IMAPDecoder.prototype.write = function(buf) {</p>

<pre>var res = &quot;&quot;, lastI = 0,
    inBase64 = this.inBase64,
    base64Accum = this.base64Accum;

// The decoder is more involved as we must handle chunks in stream.
// It is forgiving, closer to standard UTF-7 (for example, &#39;-&#39; is optional at the end).

for (var i = 0; i &lt; buf.length; i++) {
    if (!inBase64) { // We&#39;re in direct mode.
        // Write direct chars until &#39;&amp;&#39;
        if (buf[i] == andChar) {
            res += this.iconv.decode(buf.slice(lastI, i), &quot;ascii&quot;); // Write direct chars.
            lastI = i+1;
            inBase64 = true;
        }
    } else { // We decode base64.
        if (!base64IMAPChars[buf[i]]) { // Base64 ended.
            if (i == lastI &amp;&amp; buf[i] == minusChar) { // &quot;&amp;-&quot; -&gt; &quot;&amp;&quot;
                res += &quot;&amp;&quot;;
            } else {
                var b64str = base64Accum + buf.slice(lastI, i).toString().replace(/,/g, &#39;/&#39;);
                res += this.iconv.decode(new Buffer(b64str, &#39;base64&#39;), &quot;utf16-be&quot;);
            }

            if (buf[i] != minusChar) // Minus may be absorbed after base64.
                i--;

            lastI = i+1;
            inBase64 = false;
            base64Accum = &#39;&#39;;
        }
    }
}

if (!inBase64) {
    res += this.iconv.decode(buf.slice(lastI), &quot;ascii&quot;); // Write direct chars.
} else {
    var b64str = base64Accum + buf.slice(lastI).toString().replace(/,/g, &#39;/&#39;);

    var canBeDecoded = b64str.length - (b64str.length % 8); // Minimal chunk: 2 quads -&gt; 2x3 bytes -&gt; 3 chars.
    base64Accum = b64str.slice(canBeDecoded); // The rest will be decoded in future.
    b64str = b64str.slice(0, canBeDecoded);

    res += this.iconv.decode(new Buffer(b64str, &#39;base64&#39;), &quot;utf16-be&quot;);
}

this.inBase64 = inBase64;
this.base64Accum = base64Accum;

return res;</pre>

<p>}</p>

<p>Utf7IMAPDecoder.prototype.end = function() {</p>

<pre>var res = &quot;&quot;;
if (this.inBase64 &amp;&amp; this.base64Accum.length &gt; 0)
    res = this.iconv.decode(new Buffer(this.base64Accum, &#39;base64&#39;), &quot;utf16-be&quot;);

this.inBase64 = false;
this.base64Accum = &#39;&#39;;
return res;</pre>

<p>}</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://rdoc.github.io/rdoc">RDoc</a> 5.0.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

