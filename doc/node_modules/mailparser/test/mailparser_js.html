<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>mailparser.js - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../../";
  var index_rel_prefix = "../../../";
</script>

<script src="../../../js/jquery.js"></script>
<script src="../../../js/darkfish.js"></script>

<link href="../../../css/fonts.css" rel="stylesheet">
<link href="../../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../../table_of_contents.html#pages">Pages</a>
    <a href="../../../table_of_contents.html#classes">Classes</a>
    <a href="../../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../../Gemfile.html">Gemfile</a>
  
    <li><a href="../../../Gemfile_lock.html">Gemfile.lock</a>
  
    <li><a href="../../../README_md.html">README</a>
  
    <li><a href="../../../Rakefile.html">Rakefile</a>
  
    <li><a href="../../../app/assets/config/manifest_js.html">manifest.js</a>
  
    <li><a href="../../../app/assets/javascripts/application_js.html">application.js</a>
  
    <li><a href="../../../app/assets/javascripts/cable_js.html">cable.js</a>
  
    <li><a href="../../../app/assets/javascripts/pages_coffee.html">pages.coffee</a>
  
    <li><a href="../../../app/assets/stylesheets/application_css_scss.html">application.css.scss</a>
  
    <li><a href="../../../app/assets/stylesheets/custom_css_scss.html">custom.css.scss</a>
  
    <li><a href="../../../app/assets/stylesheets/pages_scss.html">pages.scss</a>
  
    <li><a href="../../../config_ru.html">config.ru</a>
  
    <li><a href="../../../log/development_log.html">development.log</a>
  
    <li><a href="../../../node_modules/addressparser/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../../node_modules/addressparser/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/addressparser/README_md.html">README</a>
  
    <li><a href="../../../node_modules/addressparser/lib/addressparser_js.html">addressparser.js</a>
  
    <li><a href="../../../node_modules/addressparser/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_ensureasync/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_ensureasync/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_ensureasync/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_queue/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_queue/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_queue/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_arrayeach/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_arrayeach/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_arrayeach/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_ensureasync/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_ensureasync/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_ensureasync/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_isarray/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_isarray/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_isarray/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_map/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_map/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_map/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_noop/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_noop/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_noop/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_onlyonce/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_onlyonce/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_onlyonce/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_queue/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_queue/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_queue/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_restparam/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_restparam/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_restparam/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_setimmediate/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_setimmediate/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_setimmediate/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/bottleneck/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/bottleneck/README_md.html">README</a>
  
    <li><a href="../../../node_modules/bottleneck/bottleneck_d_ts_ejs.html">bottleneck.d.ts.ejs</a>
  
    <li><a href="../../../node_modules/bottleneck/bottleneck_js.html">bottleneck.js</a>
  
    <li><a href="../../../node_modules/bottleneck/bottleneck_min_js.html">bottleneck.min.js</a>
  
    <li><a href="../../../node_modules/bottleneck/bower_json.html">bower.json</a>
  
    <li><a href="../../../node_modules/bottleneck/lib/Bottleneck_js.html">Bottleneck.js</a>
  
    <li><a href="../../../node_modules/bottleneck/lib/Cluster_js.html">Cluster.js</a>
  
    <li><a href="../../../node_modules/bottleneck/lib/DLList_js.html">DLList.js</a>
  
    <li><a href="../../../node_modules/bottleneck/lib/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/bottleneck/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/bottleneck/scripts/build_sh.html">build.sh</a>
  
    <li><a href="../../../node_modules/bottleneck/src/Bottleneck_coffee.html">Bottleneck.coffee</a>
  
    <li><a href="../../../node_modules/bottleneck/src/Cluster_coffee.html">Cluster.coffee</a>
  
    <li><a href="../../../node_modules/bottleneck/src/DLList_coffee.html">DLList.coffee</a>
  
    <li><a href="../../../node_modules/bottleneck/src/index_coffee.html">index.coffee</a>
  
    <li><a href="../../../node_modules/bottleneck/test_ts.html">test.ts</a>
  
    <li><a href="../../../node_modules/bottleneck/test/DLList_js.html">DLList.js</a>
  
    <li><a href="../../../node_modules/bottleneck/test/general_js.html">general.js</a>
  
    <li><a href="../../../node_modules/bottleneck/test/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/bottleneck/test/priority_js.html">priority.js</a>
  
    <li><a href="../../../node_modules/bottleneck/test/promises_js.html">promises.js</a>
  
    <li><a href="../../../node_modules/debug/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../../node_modules/debug/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/debug/Makefile.html">Makefile</a>
  
    <li><a href="../../../node_modules/debug/README_md.html">README</a>
  
    <li><a href="../../../node_modules/debug/component_json.html">component.json</a>
  
    <li><a href="../../../node_modules/debug/karma_conf_js.html">karma.conf.js</a>
  
    <li><a href="../../../node_modules/debug/node_js.html">node.js</a>
  
    <li><a href="../../../node_modules/debug/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/debug/src/browser_js.html">browser.js</a>
  
    <li><a href="../../../node_modules/debug/src/debug_js.html">debug.js</a>
  
    <li><a href="../../../node_modules/debug/src/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/debug/src/node_js.html">node.js</a>
  
    <li><a href="../../../node_modules/encoding/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/encoding/README_md.html">README</a>
  
    <li><a href="../../../node_modules/encoding/lib/encoding_js.html">encoding.js</a>
  
    <li><a href="../../../node_modules/encoding/lib/iconv-loader_js.html">iconv-loader.js</a>
  
    <li><a href="../../../node_modules/encoding/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/encoding/test/test_js.html">test.js</a>
  
    <li><a href="../../../node_modules/extend/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../../node_modules/extend/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/extend/README_md.html">README</a>
  
    <li><a href="../../../node_modules/extend/component_json.html">component.json</a>
  
    <li><a href="../../../node_modules/extend/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/extend/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/Changelog_md.html">Changelog</a>
  
    <li><a href="../../../node_modules/iconv-lite/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/iconv-lite/README_md.html">README</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/dbcs-codec_js.html">dbcs-codec.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/dbcs-data_js.html">dbcs-data.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/internal_js.html">internal.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/sbcs-codec_js.html">sbcs-codec.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/sbcs-data-generated_js.html">sbcs-data-generated.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/sbcs-data_js.html">sbcs-data.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/big5-added_json.html">big5-added.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/cp936_json.html">cp936.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/cp949_json.html">cp949.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/cp950_json.html">cp950.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/eucjp_json.html">eucjp.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/gb18030-ranges_json.html">gb18030-ranges.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/gbk-added_json.html">gbk-added.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/shiftjis_json.html">shiftjis.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/utf16_js.html">utf16.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/utf7_js.html">utf7.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/lib/bom-handling_js.html">bom-handling.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/lib/extend-node_js.html">extend-node.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/lib/index_d_ts.html">index.d.ts</a>
  
    <li><a href="../../../node_modules/iconv-lite/lib/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/lib/streams_js.html">streams.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/lodash_chunk/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/lodash_chunk/README_md.html">README</a>
  
    <li><a href="../../../node_modules/lodash_chunk/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/lodash_chunk/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/mailparser/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/mailparser/README_md.html">README</a>
  
    <li><a href="../../../node_modules/mailparser/lib/datetime_js.html">datetime.js</a>
  
    <li><a href="../../../node_modules/mailparser/lib/mailparser_js.html">mailparser.js</a>
  
    <li><a href="../../../node_modules/mailparser/lib/streams_js.html">streams.js</a>
  
    <li><a href="../../../node_modules/mailparser/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/mailparser/test/mailparser_js.html">mailparser.js</a>
  
    <li><a href="../../../node_modules/mailparser/test/mixed_eml.html">mixed.eml</a>
  
    <li><a href="../../../node_modules/mailparser/test/nested_eml.html">nested.eml</a>
  
    <li><a href="../../../node_modules/mime/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/mime/README_md.html">README</a>
  
    <li><a href="../../../node_modules/mime/build/build_js.html">build.js</a>
  
    <li><a href="../../../node_modules/mime/build/test_js.html">test.js</a>
  
    <li><a href="../../../node_modules/mime/cli_js.html">cli.js</a>
  
    <li><a href="../../../node_modules/mime/mime_js.html">mime.js</a>
  
    <li><a href="../../../node_modules/mime/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/mime/types_json.html">types.json</a>
  
    <li><a href="../../../node_modules/mimelib/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/mimelib/README_md.html">README</a>
  
    <li><a href="../../../node_modules/mimelib/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/mimelib/lib/content-types-reversed_js.html">content-types-reversed.js</a>
  
    <li><a href="../../../node_modules/mimelib/lib/content-types_js.html">content-types.js</a>
  
    <li><a href="../../../node_modules/mimelib/lib/mimelib_js.html">mimelib.js</a>
  
    <li><a href="../../../node_modules/mimelib/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/ms/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/ms/license_md.html">license</a>
  
    <li><a href="../../../node_modules/ms/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/ms/readme_md.html">readme</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/CONTRIBUTING_md.html">CONTRIBUTING</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/LICENSE_txt.html">LICENSE</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/README_md.html">README</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/examples/example_js.html">example.js</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/lib/client_js.html">client.js</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/test/test_js.html">test.js</a>
  
    <li><a href="../../../node_modules/sendgrid/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../../node_modules/sendgrid/CONTRIBUTING_md.html">CONTRIBUTING</a>
  
    <li><a href="../../../node_modules/sendgrid/LICENSE_txt.html">LICENSE</a>
  
    <li><a href="../../../node_modules/sendgrid/README_md.html">README</a>
  
    <li><a href="../../../node_modules/sendgrid/TROUBLESHOOTING_md.html">TROUBLESHOOTING</a>
  
    <li><a href="../../../node_modules/sendgrid/USAGE_md.html">USAGE</a>
  
    <li><a href="../../../node_modules/sendgrid/USE_CASES_md.html">USE_CASES</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/accesssettings/accesssettings_js.html">accesssettings.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/alerts/alerts_js.html">alerts.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/apikeys/apikeys_js.html">apikeys.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/asm/asm_js.html">asm.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/browsers/browsers_js.html">browsers.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/campaigns/campaigns_js.html">campaigns.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/categories/categories_js.html">categories.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/clients/clients_js.html">clients.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/contactdb/contactdb_js.html">contactdb.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/devices/devices_js.html">devices.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/geo/geo_js.html">geo.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/helpers/mail/example_js.html">example.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/ips/ips_js.html">ips.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/mail/mail_js.html">mail.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/mailboxproviders/mailboxproviders_js.html">mailboxproviders.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/mailsettings/mailsettings_js.html">mailsettings.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/partnersettings/partnersettings_js.html">partnersettings.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/scopes/scopes_js.html">scopes.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/senders/senders_js.html">senders.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/stats/stats_js.html">stats.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/subusers/subusers_js.html">subusers.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/suppression/suppression_js.html">suppression.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/templates/templates_js.html">templates.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/trackingsettings/trackingsettings_js.html">trackingsettings.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/user/user_js.html">user.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/whitelabel/whitelabel_js.html">whitelabel.js</a>
  
    <li><a href="../../../node_modules/sendgrid/index_d_ts.html">index.d.ts</a>
  
    <li><a href="../../../node_modules/sendgrid/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/sendgrid/lib/helpers/contact-importer/contact-importer_js.html">contact-importer.js</a>
  
    <li><a href="../../../node_modules/sendgrid/lib/helpers/error_js.html">error.js</a>
  
    <li><a href="../../../node_modules/sendgrid/lib/helpers/inbound/parse_js.html">parse.js</a>
  
    <li><a href="../../../node_modules/sendgrid/lib/helpers/mail/README_md.html">README</a>
  
    <li><a href="../../../node_modules/sendgrid/lib/helpers/mail/mail_js.html">mail.js</a>
  
    <li><a href="../../../node_modules/sendgrid/lib/sendgrid_js.html">sendgrid.js</a>
  
    <li><a href="../../../node_modules/sendgrid/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/sendgrid/test/helpers/contact-importer/contact-importer_test_js.html">contact-importer.test.js</a>
  
    <li><a href="../../../node_modules/sendgrid/test/helpers/inbound/parse_test_js.html">parse.test.js</a>
  
    <li><a href="../../../node_modules/sendgrid/test/helpers/mail/test_js.html">test.js</a>
  
    <li><a href="../../../node_modules/sendgrid/test/prism_sh.html">prism.sh</a>
  
    <li><a href="../../../node_modules/sendgrid/test/test_js.html">test.js</a>
  
    <li><a href="../../../node_modules/sendgrid/tsconfig_json.html">tsconfig.json</a>
  
    <li><a href="../../../node_modules/uue/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/uue/README_md.html">README</a>
  
    <li><a href="../../../node_modules/uue/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/uue/uue_js.html">uue.js</a>
  
    <li><a href="../../../package-lock_json.html">package-lock.json</a>
  
    <li><a href="../../../package_json.html">package.json</a>
  
    <li><a href="../../../public/404_html.html">404.html</a>
  
    <li><a href="../../../public/422_html.html">422.html</a>
  
    <li><a href="../../../public/500_html.html">500.html</a>
  
    <li><a href="../../../public/apple-touch-icon-precomposed_png.html">apple-touch-icon-precomposed.png</a>
  
    <li><a href="../../../public/apple-touch-icon_png.html">apple-touch-icon.png</a>
  
    <li><a href="../../../public/favicon_ico.html">favicon.ico</a>
  
    <li><a href="../../../public/robots_txt.html">robots</a>
  
    <li><a href="../../../tmp/pids/server_pid.html">server.pid</a>
  
    <li><a href="../../../tmp/restart_txt.html">restart</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page node_modules/mailparser/test/mailparser.js">

<p>“use strict”;</p>

<p>var MailParser = require(“../lib/mailparser”).MailParser,</p>

<pre class="ruby"><span class="ruby-identifier">encodinglib</span> = <span class="ruby-identifier">require</span>(<span class="ruby-string">&quot;encoding&quot;</span>),
<span class="ruby-identifier">fs</span> = <span class="ruby-identifier">require</span>(<span class="ruby-string">&quot;fs&quot;</span>);
</pre>

<p>exports[“General tests”] = {</p>

<pre>&quot;Many chunks&quot;: function(test) {
    var encodedText = &quot;Content-Type: text/plain; charset=utf-8\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;ÕÄ\r\n&quot; +
        &quot;ÖÜ&quot;, // \r\nÕÄÖÜ
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(1);
    var mailparser = new MailParser();

    for (var i = 0, len = mail.length; i &lt; len; i++) {
        mailparser.write(new Buffer([mail[i]]));
    }

    mailparser.end();
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;ÕÄ\nÖÜ&quot;);
        test.done();
    });
},

&quot;Many chunks - split line endings&quot;: function(test) {
    var chunks = [
        &quot;Content-Type: text/plain; charset=utf-8\r&quot;,
        &quot;\nSubject: Hi Mom\r\n\r\n&quot;,
        &quot;hello&quot;
    ];

    test.expect(1);
    var mailparser = new MailParser();

    var writeNextChunk = function() {
        var chunk = chunks.shift();
        if (chunk !== undefined) {
            mailparser.write(chunk, &#39;utf8&#39;);
            if (typeof setImmediate == &quot;function&quot;) {
                setImmediate(writeNextChunk);
            } else {
                process.nextTick(writeNextChunk);
            }
        } else {
            mailparser.end();
        }
    };

    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;hello&quot;);
        test.done();
    });

    if (typeof setImmediate == &quot;function&quot;) {
        setImmediate(writeNextChunk);
    } else {
        process.nextTick(writeNextChunk);
    }
},

&quot;Headers only&quot;: function(test) {
    var encodedText = &quot;Content-type: text/plain; charset=utf-8\r\n&quot; +
        &quot;Subject: ÕÄÖÜ&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(1);
    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.subject, &quot;ÕÄÖÜ&quot;);
        test.done();
    });
},

&quot;Body only&quot;: function(test) {
    var encodedText = &quot;\r\n&quot; +
        &quot;===&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(1);
    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;===&quot;);
        test.done();
    });
},

&quot;Different line endings&quot;: function(test) {
    var encodedText = &quot;Content-type: text/plain; charset=utf-8\r&quot; +
        &quot;Subject: ÕÄÖÜ\n&quot; +
        &quot;\r&quot; +
        &quot;1234\r\n&quot; +
        &quot;ÕÄÖÜ\r\n&quot; +
        &quot;ÜÖÄÕ\n&quot; +
        &quot;1234&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(2);
    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.subject, &quot;ÕÄÖÜ&quot;);
        test.equal(mail.text, &quot;1234\nÕÄÖÜ\nÜÖÄÕ\n1234&quot;);
        test.done();
    });
},

&quot;Headers event&quot;: function(test) {
    var encodedText = &quot;Content-type: multipart/mixed; boundary=ABC\r\n&quot; +
        &quot;X-Test: =?UTF-8?Q?=C3=95=C3=84?= =?UTF-8?Q?=C3=96=C3=9C?=\r\n&quot; +
        &quot;Subject: ABCDEF\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: base64\r\n&quot; +
        &quot;Content-Disposition: attachment; filename=\&quot;test.pdf\&quot;\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;AAECAwQFBg==\r\n&quot; +
        &quot;--ABC--&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(3);
    var mailparser = new MailParser();

    mailparser.on(&quot;headers&quot;, function(headers) {
        test.equal(headers.subject, &quot;ABCDEF&quot;);
        test.equal(headers[&#39;x-test&#39;], &quot;ÕÄÖÜ&quot;);
    });

    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function() {
        test.ok(1, &quot;Parsing ended&quot;);
        test.done();
    });
},

&quot;No priority&quot;: function(test) {
    var encodedText = &quot;Content-type: text/plain; charset=utf-8\r&quot; +
        &quot;Subject: ÕÄÖÜ\n&quot; +
        &quot;\r&quot; +
        &quot;1234&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(1);
    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.priority, &quot;normal&quot;);
        test.done();
    });
},

&quot;MS Style priority&quot;: function(test) {
    var encodedText = &quot;Content-type: text/plain; charset=utf-8\r&quot; +
        &quot;Subject: ÕÄÖÜ\n&quot; +
        &quot;X-Priority: 1 (Highest)\n&quot; +
        &quot;\r&quot; +
        &quot;1234&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(1);
    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.priority, &quot;high&quot;);
        test.done();
    });
},

&quot;Single reference&quot;: function(test) {
    var encodedText = &quot;Content-type: text/plain\r&quot; +
        &quot;References: &lt;mail1&gt;\n&quot; +
        &quot;\r&quot; +
        &quot;1234&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(1);
    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.deepEqual(mail.references, [&quot;mail1&quot;]);
        test.done();
    });
},

&quot;Multiple reference values&quot;: function(test) {
    var encodedText = &quot;Content-type: text/plain\r&quot; +
        &quot;References: &lt;mail1&gt;\n&quot; +
        &quot;    &lt;mail2&gt; &lt;mail3&gt;\n&quot; +
        &quot;\r&quot; +
        &quot;1234&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(1);
    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.deepEqual(mail.references, [&quot;mail1&quot;, &quot;mail2&quot;, &quot;mail3&quot;]);
        test.done();
    });
},

&quot;Multiple reference fields&quot;: function(test) {
    var encodedText = &quot;Content-type: text/plain\r&quot; +
        &quot;References: &lt;mail1&gt;\n&quot; +
        &quot;References: &lt;mail3&gt;\n&quot; +
        &quot;\r&quot; +
        &quot;1234&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(1);
    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.deepEqual(mail.references, [&quot;mail1&quot;, &quot;mail3&quot;]);
        test.done();
    });
},

&quot;Single in-reply-to&quot;: function(test) {
    var encodedText = &quot;Content-type: text/plain\r&quot; +
        &quot;in-reply-to: &lt;mail1&gt;\n&quot; +
        &quot;\r&quot; +
        &quot;1234&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(1);
    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.deepEqual(mail.inReplyTo, [&quot;mail1&quot;]);
        test.done();
    });
},

&quot;Multiple in-reply-to values&quot;: function(test) {
    var encodedText = &quot;Content-type: text/plain\r&quot; +
        &quot;in-reply-to: &lt;mail1&gt;\n&quot; +
        &quot;    &lt;mail2&gt; &lt;mail3&gt;\n&quot; +
        &quot;\r&quot; +
        &quot;1234&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(1);
    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.deepEqual(mail.inReplyTo, [&quot;mail1&quot;, &quot;mail2&quot;, &quot;mail3&quot;]);
        test.done();
    });
},

&quot;Multiple in-reply-to fields&quot;: function(test) {
    var encodedText = &quot;Content-type: text/plain\r&quot; +
        &quot;in-reply-to: &lt;mail1&gt;\n&quot; +
        &quot;in-reply-to: &lt;mail3&gt;\n&quot; +
        &quot;\r&quot; +
        &quot;1234&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(1);
    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.deepEqual(mail.inReplyTo, [&quot;mail1&quot;, &quot;mail3&quot;]);
        test.done();
    });
},

&quot;Reply To address&quot;: function(test) {
    var encodedText = &quot;Reply-TO: andris &lt;andris@disposebox.com&gt;\r&quot; +
        &quot;Subject: ÕÄÖÜ\n&quot; +
        &quot;\r&quot; +
        &quot;1234&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(1);
    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.deepEqual(mail.replyTo, [{
            name: &quot;andris&quot;,
            address: &quot;andris@disposebox.com&quot;
        }]);
        test.done();
    });
}</pre>

<p>};</p>

<p>exports[“Text encodings”] = {</p>

<pre>&quot;Plaintext encoding: Default&quot;: function(test) {
    var encodedText = [13, 10, 213, 196, 214, 220], // \r\nÕÄÖÜ
        mail = new Buffer(encodedText);

    test.expect(1);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;ÕÄÖÜ&quot;);
        test.done();
    });
},

&quot;Plaintext encoding: Header defined&quot;: function(test) {
    var encodedText = &quot;Content-Type: TEXT/PLAIN; CHARSET=UTF-8\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;ÕÄÖÜ&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(1);
    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;ÕÄÖÜ&quot;);
        test.done();
    });
},

&quot;HTML encoding: From &lt;meta&gt;&quot;: function(test) {
    var encodedText = &quot;Content-Type: text/html\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;&lt;html&gt;&lt;head&gt;&lt;meta charset=\&quot;utf-8\&quot;/&gt;&lt;/head&gt;&lt;body&gt;ÕÄÖÜ&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(1);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal((mail.html || &quot;&quot;).substr(-4), &quot;ÕÄÖÜ&quot;);
        test.done();
    });
},

&quot;HTML encoding: Header defined&quot;: function(test) {
    var encodedText = &quot;Content-Type: text/html; charset=iso-UTF-8\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;ÕÄÖÜ&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(1);
    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.html, &quot;ÕÄÖÜ&quot;);
        test.done();
    });
},
&quot;Mime Words&quot;: function(test) {
    var encodedText = &quot;Content-type: text/plain; charset=utf-8\r\n&quot; +
        &quot;From: =?utf-8?q??= &lt;sender@email.com&gt;\r\n&quot; +
        &quot;To: =?ISO-8859-1?Q?Keld_J=F8rn_Simonsen?= &lt;to@email.com&gt;\r\n&quot; +
        &quot;Subject: =?iso-8859-1?Q?Avaldu?= =?iso-8859-1?Q?s_lepingu_?=\r\n =?iso-8859-1?Q?l=F5petamise?= =?iso-8859-1?Q?ks?=\r\n&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.subject, &quot;Avaldus lepingu lõpetamiseks&quot;);
        test.equal(mail.from[0].name, &quot;&quot;);
        test.equal(mail.to[0].name, &quot;Keld Jørn Simonsen&quot;);
        test.done();
    });
}</pre>

<p>};</p>

<p>exports[“Binary attachment encodings”] = {</p>

<pre>&quot;Quoted-Printable&quot;: function(test) {
    var encodedText = &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: QUOTED-PRINTABLE\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(Array.prototype.slice.apply(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].content &amp;&amp; mail.attachments[0].content || []).join(&quot;,&quot;), &quot;0,1,2,3,253,254,255&quot;);
        test.done();
    });
},
&quot;Base64&quot;: function(test) {
    var encodedText = &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: base64\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;AAECA/3+/w==&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(Array.prototype.slice.apply(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].content &amp;&amp; mail.attachments[0].content || []).join(&quot;,&quot;), &quot;0,1,2,3,253,254,255&quot;);
        test.done();
    });
},
&quot;8bit&quot;: function(test) {
    var encodedText = &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;ÕÄÖÜ&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(Array.prototype.slice.apply(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].content &amp;&amp; mail.attachments[0].content || []).join(&quot;,&quot;), &quot;195,149,195,132,195,150,195,156&quot;);
        test.done();
    });
},
&quot;UUENCODE&quot;: function(test) {
    var encodedText = &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: uuencode\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;begin 644 buffer.bin\r\n&quot; +
        &quot;#0V%T\r\n&quot; +
        &quot;`\r\n&quot; +
        &quot;end&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments[0].content.toString(), &quot;Cat&quot;);
        test.done();
    });
}</pre>

<p>};</p>

<p>exports[“Attachment Content-Id”] = {</p>

<pre>&quot;Default&quot;: function(test) {
    var encodedText = &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: QUOTED-PRINTABLE\r\n&quot; +
        &quot;Content-Disposition: attachment; filename=\&quot;=?UTF-8?Q?=C3=95=C3=84=C3=96=C3=9C?=\&quot;\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].contentId, &quot;7c7cf35ce5becf62faea56ed8d0ad6e4@mailparser&quot;);
        test.done();
    });
},

&quot;Defined&quot;: function(test) {
    var encodedText = &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: QUOTED-PRINTABLE\r\n&quot; +
        &quot;Content-Disposition: attachment; filename=\&quot;=?UTF-8?Q?=C3=95=C3=84=C3=96=C3=9C?=\&quot;\r\n&quot; +
        &quot;Content-Id: test@localhost\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].contentId, &quot;test@localhost&quot;);
        test.done();
    });
}</pre>

<p>};</p>

<p>exports[“Attachment filename”] = {</p>

<pre>&quot;Content-Disposition filename&quot;: function(test) {
    var encodedText = &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: QUOTED-PRINTABLE\r\n&quot; +
        &quot;Content-Disposition: attachment; filename=\&quot;=?UTF-8?Q?=C3=95=C3=84=C3=96=C3=9C?=\&quot;\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].content &amp;&amp; mail.attachments[0].fileName, &quot;ÕÄÖÜ&quot;);
        test.done();
    });
},
&quot;Content-Disposition filename*&quot;: function(test) {
    var encodedText = &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: QUOTED-PRINTABLE\r\n&quot; +
        &quot;Content-Disposition: attachment; filename*=\&quot;UTF-8&#39;&#39;%C3%95%C3%84%C3%96%C3%9C\&quot;\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].content &amp;&amp; mail.attachments[0].fileName, &quot;ÕÄÖÜ&quot;);
        test.done();
    });
},
&quot;Content-Disposition filename*X&quot;: function(test) {
    var encodedText = &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: QUOTED-PRINTABLE\r\n&quot; +
        &quot;Content-Disposition: attachment;\r\n&quot; +
        &quot;    filename*0=OA;\r\n&quot; +
        &quot;    filename*1=U;\r\n&quot; +
        &quot;    filename*2=.txt\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].content &amp;&amp; mail.attachments[0].fileName, &quot;OAU.txt&quot;);
        test.done();
    });
},
&quot;Content-Disposition filename*X*&quot;: function(test) {
    var encodedText = &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: QUOTED-PRINTABLE\r\n&quot; +
        &quot;Content-Disposition: attachment;\r\n&quot; +
        &quot;    filename*0*=UTF-8&#39;&#39;%C3%95%C3%84;\r\n&quot; +
        &quot;    filename*1*=%C3%96%C3%9C\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].content &amp;&amp; mail.attachments[0].fileName, &quot;ÕÄÖÜ&quot;);
        test.done();
    });
},
&quot;Content-Disposition filename*X* mixed&quot;: function(test) {
    var encodedText = &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: QUOTED-PRINTABLE\r\n&quot; +
        &quot;Content-Disposition: attachment;\r\n&quot; +
        &quot;    filename*0*=UTF-8&#39;&#39;%C3%95%C3%84;\r\n&quot; +
        &quot;    filename*1*=%C3%96%C3%9C;\r\n&quot; +
        &quot;    filename*2=.txt\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].content &amp;&amp; mail.attachments[0].fileName, &quot;ÕÄÖÜ.txt&quot;);
        test.done();
    });
},

&quot;Content-Type name&quot;: function(test) {
    var encodedText = &quot;Content-Type: application/octet-stream; name=\&quot;=?UTF-8?Q?=C3=95=C3=84=C3=96=C3=9C?=\&quot;\r\n&quot; +
        &quot;Content-Transfer-Encoding: QUOTED-PRINTABLE\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].content &amp;&amp; mail.attachments[0].fileName, &quot;ÕÄÖÜ&quot;);
        test.done();
    });
},
&quot;Content-Type ; name&quot;: function(test) {
    var encodedText = &quot;Content-Type: ; name=\&quot;test\&quot;\r\n&quot; +
        &quot;Content-Transfer-Encoding: QUOTED-PRINTABLE\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();

    mailparser.write(mail);
    mailparser.end();

    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].fileName, &quot;test&quot;);
        test.done();
    });
},
&quot;Content-Type name*&quot;: function(test) {
    var encodedText = &quot;Content-Type: application/octet-stream;\r\n&quot; +
        &quot;    name*=UTF-8&#39;&#39;%C3%95%C3%84%C3%96%C3%9C\r\n&quot; +
        &quot;Content-Transfer-Encoding: QUOTED-PRINTABLE\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].content &amp;&amp; mail.attachments[0].fileName, &quot;ÕÄÖÜ&quot;);
        test.done();
    });
},
&quot;Content-Type name*X*&quot;: function(test) {
    var encodedText = &quot;Content-Type: application/octet-stream;\r\n&quot; +
        &quot;    name*0*=UTF-8&#39;&#39;%C3%95%C3%84;\r\n&quot; +
        &quot;    name*1*=%C3%96%C3%9C\r\n&quot; +
        &quot;Content-Transfer-Encoding: QUOTED-PRINTABLE\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].content &amp;&amp; mail.attachments[0].fileName, &quot;ÕÄÖÜ&quot;);
        test.done();
    });
},
&quot;Default name from Content-type&quot;: function(test) {
    var encodedText = &quot;Content-Type: application/pdf\r\n&quot; +
        &quot;Content-Transfer-Encoding: QUOTED-PRINTABLE\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].content &amp;&amp; mail.attachments[0].generatedFileName, &quot;attachment.pdf&quot;);
        test.done();
    });
},
&quot;Default name&quot;: function(test) {
    var encodedText = &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: QUOTED-PRINTABLE\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].content &amp;&amp; mail.attachments[0].generatedFileName, &quot;attachment.bin&quot;);
        test.done();
    });
},
&quot;Multiple filenames - Same&quot;: function(test) {
    var encodedText = &quot;Content-Type: multipart/mixed; boundary=ABC\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream; name=\&quot;test.txt\&quot;\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream; name=\&quot;test.txt\&quot;\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF\r\n&quot; +
        &quot;--ABC--&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].content &amp;&amp; mail.attachments[0].generatedFileName, &quot;test.txt&quot;);
        test.equal(mail.attachments &amp;&amp; mail.attachments[1] &amp;&amp; mail.attachments[1].content &amp;&amp; mail.attachments[1].generatedFileName, &quot;test-1.txt&quot;);
        test.done();
    });
},
&quot;Multiple filenames - Different&quot;: function(test) {
    var encodedText = &quot;Content-Type: multipart/mixed; boundary=ABC\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream; name=\&quot;test.txt\&quot;\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF\r\n&quot; +
        &quot;--ABC--&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].content &amp;&amp; mail.attachments[0].generatedFileName, &quot;attachment.bin&quot;);
        test.equal(mail.attachments &amp;&amp; mail.attachments[1] &amp;&amp; mail.attachments[1].content &amp;&amp; mail.attachments[1].generatedFileName, &quot;test.txt&quot;);
        test.done();
    });
},
&quot;Multiple filenames - with number&quot;: function(test) {
    var encodedText = &quot;Content-Type: multipart/mixed; boundary=ABC\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream; name=\&quot;somename.txt\&quot;\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream; name=\&quot;somename-1.txt\&quot;\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream; name=\&quot;somename.txt\&quot;\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream; name=\&quot;somename-1-1.txt\&quot;\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF\r\n&quot; +
        &quot;--ABC--&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].content &amp;&amp; mail.attachments[0].generatedFileName, &quot;somename.txt&quot;);
        test.equal(mail.attachments &amp;&amp; mail.attachments[1] &amp;&amp; mail.attachments[1].content &amp;&amp; mail.attachments[1].generatedFileName, &quot;somename-1-1.txt&quot;);
        test.equal(mail.attachments &amp;&amp; mail.attachments[2] &amp;&amp; mail.attachments[2].content &amp;&amp; mail.attachments[2].generatedFileName, &quot;somename-2.txt&quot;);
        test.equal(mail.attachments &amp;&amp; mail.attachments[3] &amp;&amp; mail.attachments[3].content &amp;&amp; mail.attachments[3].generatedFileName, &quot;somename-1-1-3.txt&quot;);
        test.done();
    });
},
&quot;Generate filename from Content-Type&quot;: function(test) {
    var encodedText = &quot;Content-Type: multipart/mixed; boundary=ABC\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/pdf\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF\r\n&quot; +
        &quot;--ABC--&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].content &amp;&amp; mail.attachments[0].generatedFileName, &quot;attachment.pdf&quot;);
        test.done();
    });
},
&quot;Filename with semicolon&quot;: function(test) {
    var encodedText = &quot;Content-Type: multipart/mixed; boundary=ABC\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Disposition: attachment; filename=\&quot;hello;world;test.txt\&quot;\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=FD=FE=FF\r\n&quot; +
        &quot;--ABC--&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].content &amp;&amp; mail.attachments[0].generatedFileName, &quot;hello;world;test.txt&quot;);
        test.done();
    });
},
&quot;UUE filename with special characters&quot;: function(test) {
    var encodedText = &quot;Content-Type: multipart/mixed; boundary=ABC\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: uuencode\r\n&quot; +
        &quot;Content-Disposition: attachment; filename=\&quot;hello ~!@#%.txt\&quot;\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;begin 644 hello ~!@#%.txt\r\n&quot; +
        &quot;#0V%T\r\n&quot; +
        &quot;`\r\n&quot; +
        &quot;end\r\n&quot; +
        &quot;--ABC--&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].content &amp;&amp; mail.attachments[0].generatedFileName, &quot;hello ~!@#%.txt&quot;);
        test.done();
    });
}</pre>

<p>};</p>

<p>exports[“Plaintext format”] = {</p>

<pre>&quot;Default&quot;: function(test) {
    var encodedText = &quot;Content-Type: text/plain;\r\n\r\nFirst line \r\ncontinued&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;First line \ncontinued&quot;);
        test.done();
    });
},
&quot;Flowed&quot;: function(test) {
    var encodedText = &quot;Content-Type: text/plain; format=flowed\r\n\r\nFirst line \r\ncontinued \r\nand so on&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;First line continued and so on&quot;);
        test.done();
    });
},
&quot;Flowed Signature&quot;: function(test) {
    var encodedText = &quot;Content-Type: text/plain; format=flowed\r\n\r\nHow are you today?\r\n&quot; +
        &quot;-- \r\n&quot; +
        &quot;Signature\r\n&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;How are you today?\n-- \nSignature\n&quot;);
        test.done();
    });
},
&quot;Fixed&quot;: function(test) {
    var encodedText = &quot;Content-Type: text/plain; format=fixed\r\n\r\nFirst line \r\ncontinued \r\nand so on&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;First line \ncontinued \nand so on&quot;);
        test.done();
    });
},
&quot;DelSp&quot;: function(test) {
    var encodedText = &quot;Content-Type: text/plain; format=flowed; delsp=yes\r\n\r\nFirst line \r\ncontinued \r\nand so on&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;First linecontinuedand so on&quot;);
        test.done();
    });
},
&quot;Quoted printable, Flowed&quot;: function(test) {
    var encodedText = &quot;Content-Type: text/plain; format=flowed\r\nContent-Transfer-Encoding: QUOTED-PRINTABLE\r\n\r\nFoo =\n\nBar =\n\nBaz&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;Foo Bar Baz&quot;);
        test.done();
    });
},
&quot;Quoted printable, Flowed Signature&quot;: function(test) {
    var encodedText = &quot;Content-Type: text/plain; format=flowed\r\nContent-Transfer-Encoding: QUOTED-PRINTABLE\r\n\r\nHow are you today?\r\n&quot; +
        &quot;-- \r\n&quot; +
        &quot;Signature\r\n&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;How are you today?\n-- \nSignature\n&quot;);
        test.done();
    });
},
&quot;Quoted printable, DelSp&quot;: function(test) {
    var encodedText = &quot;Content-Type: text/plain; format=flowed; delsp=yes\r\nContent-Transfer-Encoding: QUOTED-PRINTABLE\r\n\r\nFoo =\n\nBar =\n\nBaz&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;FooBarBaz&quot;);
        test.done();
    });
}</pre>

<p>};</p>

<p>exports[“Transfer encoding”] = {</p>

<pre>&quot;Quoted-Printable Default charset&quot;: function(test) {
    var encodedText = &quot;Content-type: text/plain\r\nContent-Transfer-Encoding: quoted-printable\r\n\r\n=D5=C4=D6=DC&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;ÕÄÖÜ&quot;);
        test.done();
    });
},
&quot;Quoted-Printable UTF-8&quot;: function(test) {
    var encodedText = &quot;Content-type: text/plain; charset=utf-8\r\nContent-Transfer-Encoding: QUOTED-PRINTABLE\r\n\r\n=C3=95=C3=84=C3=96=C3=9C&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;ÕÄÖÜ&quot;);
        test.done();
    });
},
&quot;Base64 Default charset&quot;: function(test) {
    var encodedText = &quot;Content-type: text/plain\r\nContent-Transfer-Encoding: bAse64\r\n\r\n1cTW3A==&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;ÕÄÖÜ&quot;);
        test.done();
    });
},
&quot;Base64 UTF-8&quot;: function(test) {
    var encodedText = &quot;Content-type: text/plain; charset=utf-8\r\nContent-Transfer-Encoding: bAse64\r\n\r\nw5XDhMOWw5w=&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;ÕÄÖÜ&quot;);
        test.done();
    });
},
&quot;Mime Words&quot;: function(test) {
    var encodedText = &quot;Content-type: text/plain; charset=utf-8\r\nSubject: =?iso-8859-1?Q?Avaldu?= =?iso-8859-1?Q?s_lepingu_?=\r\n =?iso-8859-1?Q?l=F5petamise?= =?iso-8859-1?Q?ks?=\r\n&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.subject, &quot;Avaldus lepingu lõpetamiseks&quot;);
        test.done();
    });
},
&quot;Mime Words with invalid linebreaks (Sparrow)&quot;: function(test) {
    var encodedText = &quot;Content-type: text/plain; charset=utf-8\r\n&quot; +
        &quot;Subject: abc=?utf-8?Q?=C3=B6=C\r\n&quot; +
        &quot; 3=B5=C3=BC?=&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.subject, &quot;abcöõü&quot;);
        test.done();
    });
},
&quot;8bit Default charset&quot;: function(test) {
    var encodedText = &quot;Content-type: text/plain\r\nContent-Transfer-Encoding: 8bit\r\n\r\nÕÄÖÜ&quot;,
        textmap = encodedText.split(&#39;&#39;).map(function(chr) {
            return chr.charCodeAt(0);
        }),
        mail = new Buffer(textmap);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;ÕÄÖÜ&quot;);
        test.done();
    });
},
&quot;8bit UTF-8&quot;: function(test) {
    var encodedText = &quot;Content-type: text/plain; charset=utf-8\r\nContent-Transfer-Encoding: 8bit\r\n\r\nÕÄÖÜ&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;ÕÄÖÜ&quot;);
        test.done();
    });
},
&quot;Invalid Quoted-Printable&quot;: function(test) {
    var encodedText = &quot;Content-type: text/plain; charset=utf-8\r\nContent-Transfer-Encoding: QUOTED-PRINTABLE\r\n\r\n==C3==95=C3=84=C3=96=C3=9C=&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;=�=�ÄÖÜ&quot;);
        test.done();
    });
},
&quot;Invalid BASE64&quot;: function(test) {
    var encodedText = &quot;Content-type: text/plain; charset=utf-8\r\nContent-Transfer-Encoding: base64\r\n\r\nw5XDhMOWw5&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(Array.prototype.map.call(mail.text, function(chr) {
            return chr.charCodeAt(0);
        }).join(&quot;,&quot;), &quot;213,196,214,65533&quot;);
        test.done();
    });
},
&quot;gb2312 mime words&quot;: function(test) {
    var encodedText = &quot;From: =?gb2312?B?086yyZjl?= user@ldkf.com.tw\r\n\r\nBody&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.deepEqual(mail.from, [{
            address: &#39;user@ldkf.com.tw&#39;,
            name: &#39;游采樺&#39;
        }]);
        test.done();
    });
},
&quot;Valid Date header&quot;: function(test) {
    var encodedText = &quot;Date: Wed, 08 Jan 2014 09:52:26 -0800\r\n\r\n1cTW3A==&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.date.toISOString(), &quot;2014-01-08T17:52:26.000Z&quot;);
        test.equal(mail.headers.date, &quot;Wed, 08 Jan 2014 09:52:26 -0800&quot;);
        test.done();
    });
},
&quot;Invalid Date header&quot;: function(test) {
    var encodedText = &quot;Date: zzzzz\r\n\r\n1cTW3A==&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.ok(!mail.date);
        test.equal(mail.headers.date, &quot;zzzzz&quot;);
        test.done();
    });
},
&quot;Missing Date header&quot;: function(test) {
    var encodedText = &quot;Subject: test\r\n\r\n1cTW3A==&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.ok(!mail.date);
        test.equal(mail.headers.date, undefined);
        test.done();
    });
},
&quot;Received Headers&quot;: function(test) {
    var encodedTest = &quot;Received: by 10.25.25.72 with SMTP id 69csp2404548lfz;\r\n&quot; +
        &quot;        Fri, 6 Feb 2015 20:15:32 -0800 (PST)\r\n&quot; +
        &quot;X-Received: by 10.194.200.68 with SMTP id jq4mr7518476wjc.128.1423264531879;\r\n&quot; +
        &quot;        Fri, 06 Feb 2015 15:15:31 -0800 (PST)\r\n&quot; +
        &quot;Received: from mail.formilux.org (flx02.formilux.org. [195.154.117.161])\r\n&quot; +
        &quot;        by mx.google.com with ESMTP id wn4si6920692wjc.106.2015.02.06.15.15.31\r\n&quot; +
        &quot;        for &lt;test@example.com&gt;;\r\n&quot; +
        &quot;        Fri, 06 Feb 2015 15:15:31 -0800 (PST)\r\n&quot; +
        &quot;Received: from flx02.formilux.org (flx02.formilux.org [127.0.0.1])\r\n&quot; +
        &quot;        by mail.formilux.org (Postfix) with SMTP id 9D262450C77\r\n&quot; +
        &quot;        for &lt;test@example.com&gt;; Sat,  7 Feb 2015 00:15:31 +0100 (CET)\r\n&quot; +
        &quot;Date: Fri, 6 Feb 2015 16:13:51 -0700 (MST)\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;1cTW3A==&quot;,
        mail = new Buffer(encodedTest, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.ok(mail.date);
        test.ok(mail.receivedDate);
        test.equal(mail.date.toISOString(), &quot;2015-02-06T23:13:51.000Z&quot;);
        test.equal(mail.receivedDate.toISOString(), &quot;2015-02-07T04:15:32.000Z&quot;);
        test.done();
    });
}</pre>

<p>};</p>

<p>exports[“Multipart content”] = {</p>

<pre>&quot;Simple&quot;: function(test) {
    var encodedText = &quot;Content-type: multipart/mixed; boundary=ABC\r\n\r\n--ABC\r\nContent-type: text/plain; charset=utf-8\r\n\r\nÕÄÖÜ\r\n--ABC--&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;ÕÄÖÜ&quot;);
        test.done();
    });
},
&quot;Nested&quot;: function(test) {
    var encodedText = &quot;Content-type: multipart/mixed; boundary=ABC\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-type: multipart/related; boundary=DEF\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--DEF\r\n&quot; +
        &quot;Content-type: text/plain; charset=utf-8\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;ÕÄÖÜ\r\n&quot; +
        &quot;--DEF--\r\n&quot; +
        &quot;--ABC--&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;ÕÄÖÜ&quot;);
        test.done();
    });
},
&quot;Inline text (Sparrow)&quot;: function(test) {
    var encodedText = &quot;Content-type: multipart/mixed; boundary=ABC\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: text/plain; charset=\&quot;utf-8\&quot;\r\n&quot; +
        &quot;Content-Transfer-Encoding: 8bit\r\n&quot; +
        &quot;Content-Disposition: inline\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;ÕÄÖÜ\r\n&quot; +
        &quot;--ABC--&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;ÕÄÖÜ&quot;);
        test.done();
    });
},
&quot;Different Levels&quot;: function(test) {
    var encodedText = &quot;Content-type: multipart/mixed; boundary=ABC\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-type: text/html; charset=utf-8\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;ÕÄÖÜ2\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-type: multipart/related; boundary=DEF\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--DEF\r\n&quot; +
        &quot;Content-type: text/plain; charset=utf-8\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;ÕÄÖÜ1\r\n&quot; +
        &quot;--DEF--\r\n&quot; +
        &quot;--ABC--&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();
    mailparser.end(mail);

    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;ÕÄÖÜ1&quot;);
        test.equal(mail.html, &quot;ÕÄÖÜ2&quot;);
        test.done();
    });
}</pre>

<p>};</p>

<p>exports[“Attachment info”] = {</p>

<pre>&quot;Included integrity&quot;: function(test) {
    var encodedText = &quot;Content-type: multipart/mixed; boundary=ABC\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: quoted-printable\r\n&quot; +
        &quot;Content-Disposition: attachment\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=00=01=02=03=04=05=06\r\n&quot; +
        &quot;--ABC--&quot;,
        expectedHash = &quot;9aa461e1eca4086f9230aa49c90b0c61&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();

    for (var i = 0, len = mail.length; i &lt; len; i++) {
        mailparser.write(new Buffer([mail[i]]));
    }
    mailparser.end();

    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].checksum, expectedHash);
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].length, 7);
        test.done();
    });
},
&quot;Stream integrity base64&quot;: function(test) {
    var encodedText = &quot;Content-type: multipart/mixed; boundary=ABC\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: base64\r\n&quot; +
        &quot;Content-Disposition: attachment\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;AAECAwQFBg==\r\n&quot; +
        &quot;--ABC--&quot;,
        expectedHash = &quot;9aa461e1eca4086f9230aa49c90b0c61&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser({
        streamAttachments: true
    });

    for (var i = 0, len = mail.length; i &lt; len; i++) {
        mailparser.write(new Buffer([mail[i]]));
    }

    test.expect(3);

    mailparser.on(&quot;attachment&quot;, function(attachment) {
        test.ok(attachment.stream, &quot;Stream detected&quot;);
    });

    mailparser.end();

    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].checksum, expectedHash);
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].length, 7);
        test.done();
    });
},
&quot;Stream integrity - 8bit&quot;: function(test) {
    var encodedText = &quot;Content-type: multipart/mixed; boundary=ABC\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: 8bit\r\n&quot; +
        &quot;Content-Disposition: attachment\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;ÕÄ\r\n&quot; +
        &quot;ÖÜ\r\n&quot; +
        &quot;--ABC--&quot;,
        expectedHash = &quot;cad0f72629a7245dd3d2cbf41473e3ca&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser({
        streamAttachments: true
    });

    for (var i = 0, len = mail.length; i &lt; len; i++) {
        mailparser.write(new Buffer([mail[i]]));
    }

    test.expect(4);

    mailparser.on(&quot;attachment&quot;, function(attachment, node) {
        test.ok(attachment.stream, &quot;Stream detected&quot;);
        test.ok(node);
    });

    mailparser.end();

    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].checksum, expectedHash);
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].length, 10);
        test.done();
    });
},
&quot;Stream integrity - binary, non utf-8&quot;: function(test) {
    var encodedText = &quot;Content-type: multipart/mixed; boundary=ABC\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: 8bit\r\n&quot; +
        &quot;Content-Disposition: attachment\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;ÕÄ\r\n&quot; +
        &quot;ÖÜ\r\n&quot; +
        &quot;ŽŠ\r\n&quot; +
        &quot;--ABC--&quot;,
        expectedHash = &quot;34bca86f8cc340bbd11446ee16ee3cae&quot;,
        mail = encodinglib.convert(encodedText, &quot;latin-13&quot;);

    var mailparser = new MailParser({
        streamAttachments: true
    });

    for (var i = 0, len = mail.length; i &lt; len; i++) {
        mailparser.write(new Buffer([mail[i]]));
    }

    test.expect(3);

    mailparser.on(&quot;attachment&quot;, function(attachment) {
        test.ok(attachment.stream, &quot;Stream detected&quot;);
    });

    mailparser.end();

    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].checksum, expectedHash);
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].length, 10);
        test.done();
    });
},
&quot;Stream integrity - qp, non utf-8&quot;: function(test) {
    var encodedText = &quot;Content-type: multipart/mixed; boundary=ABC\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream; charset=iso-8859-13\r\n&quot; +
        &quot;Content-Transfer-Encoding: quoted-printable\r\n&quot; +
        &quot;Content-Disposition: attachment\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;=d5=c4\r\n&quot; +
        &quot;=d6=dc\r\n&quot; +
        &quot;=de=d0\r\n&quot; +
        &quot;--ABC--&quot;,
        expectedHash = &quot;34bca86f8cc340bbd11446ee16ee3cae&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser({
        streamAttachments: true
    });

    for (var i = 0, len = mail.length; i &lt; len; i++) {
        mailparser.write(new Buffer([mail[i]]));
    }

    test.expect(3);

    mailparser.on(&quot;attachment&quot;, function(attachment) {
        test.ok(attachment.stream, &quot;Stream detected&quot;);
    });

    mailparser.end();

    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].checksum, expectedHash);
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].length, 10);
        test.done();
    });
},
&quot;Stream integrity - uuencode&quot;: function(test) {
    var encodedText = &quot;Content-type: multipart/mixed; boundary=ABC\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: uuencode\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;begin 644 buffer.bin\r\n&quot; +
        &quot;#0V%T\r\n&quot; +
        &quot;`\r\n&quot; +
        &quot;end\r\n&quot; +
        &quot;--ABC--&quot;,
        expectedHash = &quot;fa3ebd6742c360b2d9652b7f78d9bd7d&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser({
        streamAttachments: true
    });

    for (var i = 0, len = mail.length; i &lt; len; i++) {
        mailparser.write(new Buffer([mail[i]]));
    }

    test.expect(3);

    mailparser.on(&quot;attachment&quot;, function(attachment) {
        test.ok(attachment.stream, &quot;Stream detected&quot;);
    });

    mailparser.end();

    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].checksum, expectedHash);
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].length, 3);
        test.done();
    });
},
&quot;Attachment in root node&quot;: function(test) {
    var encodedText = &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: 8bit\r\n&quot; +
        &quot;Content-Disposition: attachment\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;ÕÄ\r\n&quot; +
        &quot;ÖÜ&quot;,
        expectedHash = &quot;cad0f72629a7245dd3d2cbf41473e3ca&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser({
        streamAttachments: true
    });

    for (var i = 0, len = mail.length; i &lt; len; i++) {
        mailparser.write(new Buffer([mail[i]]));
    }

    test.expect(4);

    mailparser.on(&quot;attachment&quot;, function(attachment, node) {
        test.ok(attachment.stream, &quot;Stream detected&quot;);
        test.ok(node);
    });

    mailparser.end();

    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].checksum, expectedHash);
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].length, 10);
        test.done();
    });
},
&quot;Stream multiple attachments&quot;: function(test) {
    var encodedText = &quot;Content-type: multipart/mixed; boundary=ABC\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: base64\r\n&quot; +
        &quot;Content-Disposition: attachment\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;AAECAwQFBg==\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: base64\r\n&quot; +
        &quot;Content-Disposition: attachment\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;AAECAwQFBg==\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: base64\r\n&quot; +
        &quot;Content-Disposition: attachment; filename=\&quot;test.txt\&quot;\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;AAECAwQFBg==\r\n&quot; +
        &quot;--ABC--&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser({
        streamAttachments: true
    });

    test.expect(3); // should be 3 attachments
    mailparser.on(&quot;attachment&quot;, function(attachment) {
        test.ok(attachment.stream, &quot;Stream detected&quot;);
    });

    mailparser.end(mail);

    mailparser.on(&quot;end&quot;, function() {
        test.done();
    });
},

&quot;Pass mail node to headers event&quot;: function(test) {
    var encodedText = &quot;Content-type: multipart/mixed; boundary=ABC\r\n&quot; +
        &quot;Subject: ABCDEF\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: base64\r\n&quot; +
        &quot;Content-Disposition: attachment\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;AAECAwQFBg==\r\n&quot; +
        &quot;--ABC--&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser({
        streamAttachments: true
    });

    for (var i = 0, len = mail.length; i &lt; len; i++) {
        mailparser.write(new Buffer([mail[i]]));
    }

    test.expect(2);

    mailparser.on(&quot;attachment&quot;, function(attachment, email) {
        test.equal(email.subject, &quot;ABCDEF&quot;);
    });

    mailparser.end();

    mailparser.on(&quot;end&quot;, function() {
        test.ok(1, &quot;Done&quot;);
        test.done();
    });
},
&quot;Detect Content-Type by filename&quot;: function(test) {
    var encodedText = &quot;Content-type: multipart/mixed; boundary=ABC\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: base64\r\n&quot; +
        &quot;Content-Disposition: attachment; filename=\&quot;test.pdf\&quot;\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;AAECAwQFBg==\r\n&quot; +
        &quot;--ABC--&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    var mailparser = new MailParser();

    mailparser.write(mail);
    mailparser.end();

    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.attachments &amp;&amp; mail.attachments[0] &amp;&amp; mail.attachments[0].contentType, &quot;application/pdf&quot;);
        test.done();
    });
},

&quot;Inline attachments&quot;: function(test) {
    var encodedText = &quot;Content-type: multipart/mixed; boundary=ABC\r\n&quot; +
        &quot;X-Test: =?UTF-8?Q?=C3=95=C3=84?= =?UTF-8?Q?=C3=96=C3=9C?=\r\n&quot; +
        &quot;Subject: ABCDEF\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: text/html\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;&lt;p&gt;test 1&lt;/p&gt;\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: application/octet-stream\r\n&quot; +
        &quot;Content-Transfer-Encoding: base64\r\n&quot; +
        &quot;Content-Disposition: attachment; filename=\&quot;test.pdf\&quot;\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;AAECAwQFBg==\r\n&quot; +
        &quot;--ABC\r\n&quot; +
        &quot;Content-Type: text/html\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;&lt;p&gt;test 2&lt;/p&gt;\r\n&quot; +
        &quot;--ABC--&quot;,
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(1);
    var mailparser = new MailParser({
        showAttachmentLinks: true
    });

    mailparser.end(mail);
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.html, &#39;&lt;p&gt;test 1&lt;/p&gt;&lt;br/&gt;\n\n&lt;div class=&quot;mailparser-attachment&quot;&gt;&lt;a href=&quot;cid:754dc77d28e62763c4916970d595a10f@mailparser&quot;&gt;&amp;lt;test.pdf&amp;gt;&lt;/a&gt;&lt;/div&gt;&lt;br/&gt;\n&lt;p&gt;test 2&lt;/p&gt;&#39;);
        test.done();
    });
}</pre>

<p>};</p>

<p>exports[“Advanced nested HTML”] = function(test) {</p>

<pre>var mail = fs.readFileSync(__dirname + &quot;/ali.eml&quot;);

test.expect(2);
var mailparser = new MailParser();

for (var i = 0, len = mail.length; i &lt; len; i++) {
    mailparser.write(new Buffer([mail[i]]));
}

mailparser.end();
mailparser.on(&quot;end&quot;, function(mail) {
    console.log(require(&#39;util&#39;).inspect(mail, false, 22));
    test.equal(mail.text, &quot;\nDear Sir,\n\nGood evening.\n\n\n \n\n\n\nThe footer\n&quot;);
    test.equal(mail.html, &quot;&lt;p&gt;Dear Sir&lt;/p&gt;\n&lt;p&gt;Good evening.&lt;/p&gt;\n&lt;p&gt;&lt;/p&gt;&lt;p&gt;The footer&lt;/p&gt;\n&quot;);
    test.done();
});</pre>

<p>};</p>

<p>exports[“Additional text”] = function(test) {</p>

<pre>var mail = fs.readFileSync(__dirname + &quot;/mixed.eml&quot;);

test.expect(2);
var mailparser = new MailParser();

for (var i = 0, len = mail.length; i &lt; len; i++) {
  mailparser.write(new Buffer([mail[i]]));
}

mailparser.end();
mailparser.on(&quot;end&quot;, function(mail) {
  test.equal(mail.text, &quot;\nThis e-mail message has been scanned for Viruses and Content and cleared\nGood Morning;\n\n&quot;);
  test.equal(mail.html, &quot;&lt;HTML&gt;&lt;HEAD&gt;\n&lt;/HEAD&gt;&lt;BODY&gt; \n\n&lt;HR&gt;\nThis e-mail message has been scanned for Viruses and Content and cleared\n&lt;HR&gt;\n&lt;/BODY&gt;&lt;/HTML&gt;\nGood Morning;\n\n&quot;);
  test.done();
});</pre>

<p>};</p>

<p>exports[“MBOX format”] = {</p>

<pre>&quot;Not a mbox&quot;: function(test) {
    var encodedText = &quot;Content-Type: text/plain; charset=utf-8\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;ÕÄ\r\n&quot; +
        &quot;ÖÜ&quot;, // \r\nÕÄÖÜ
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(1);
    var mailparser = new MailParser();

    for (var i = 0, len = mail.length; i &lt; len; i++) {
        mailparser.write(new Buffer([mail[i]]));
    }

    mailparser.end();
    mailparser.on(&quot;end&quot;, function() {
        test.equal(mailparser._isMbox, false);
        test.done();
    });
},

&quot;Is a mbox&quot;: function(test) {
    var encodedText = &quot;From MAILER-DAEMON Fri Jul  8 12:08:34 2011\r\n&quot; +
        &quot;Content-Type: text/plain; charset=utf-8\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;ÕÄ\r\n&quot; +
        &quot;ÖÜ&quot;, // \r\nÕÄÖÜ
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(1);
    var mailparser = new MailParser();

    for (var i = 0, len = mail.length; i &lt; len; i++) {
        mailparser.write(new Buffer([mail[i]]));
    }

    mailparser.end();
    mailparser.on(&quot;end&quot;, function() {
        test.equal(mailparser._isMbox, true);
        test.done();
    });
},

&quot;Don&#39;t unescape &#39;&gt;From &#39;&quot;: function(test) {
    var encodedText = &quot;Content-Type: text/plain; charset=utf-8\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;&gt;From test\r\n&quot; +
        &quot;&gt;&gt;From pest&quot;, // \r\nÕÄÖÜ
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(1);
    var mailparser = new MailParser();

    for (var i = 0, len = mail.length; i &lt; len; i++) {
        mailparser.write(new Buffer([mail[i]]));
    }

    mailparser.end();
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;&gt;From test\n&gt;&gt;From pest&quot;);
        test.done();
    });
},

&quot;Unescape &#39;&gt;From &#39;&quot;: function(test) {
    var encodedText = &quot;From MAILER-DAEMON Fri Jul  8 12:08:34 2011\r\n&quot; +
        &quot;Content-Type: text/plain; charset=utf-8\r\n&quot; +
        &quot;\r\n&quot; +
        &quot;&gt;From test\r\n&quot; +
        &quot;&gt;&gt;From pest&quot;, // \r\nÕÄÖÜ
        mail = new Buffer(encodedText, &quot;utf-8&quot;);

    test.expect(1);
    var mailparser = new MailParser();

    for (var i = 0, len = mail.length; i &lt; len; i++) {
        mailparser.write(new Buffer([mail[i]]));
    }

    mailparser.end();
    mailparser.on(&quot;end&quot;, function(mail) {
        test.equal(mail.text, &quot;From test\n&gt;From pest&quot;);
        test.done();
    });
}</pre>

<p>};</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://rdoc.github.io/rdoc">RDoc</a> 5.0.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

