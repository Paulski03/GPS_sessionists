<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>addressparser.js - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../../";
  var index_rel_prefix = "../../../";
</script>

<script src="../../../js/jquery.js"></script>
<script src="../../../js/darkfish.js"></script>

<link href="../../../css/fonts.css" rel="stylesheet">
<link href="../../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../../table_of_contents.html#pages">Pages</a>
    <a href="../../../table_of_contents.html#classes">Classes</a>
    <a href="../../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../../Gemfile.html">Gemfile</a>
  
    <li><a href="../../../Gemfile_lock.html">Gemfile.lock</a>
  
    <li><a href="../../../README_md.html">README</a>
  
    <li><a href="../../../Rakefile.html">Rakefile</a>
  
    <li><a href="../../../app/assets/config/manifest_js.html">manifest.js</a>
  
    <li><a href="../../../app/assets/javascripts/application_js.html">application.js</a>
  
    <li><a href="../../../app/assets/javascripts/cable_js.html">cable.js</a>
  
    <li><a href="../../../app/assets/javascripts/pages_coffee.html">pages.coffee</a>
  
    <li><a href="../../../app/assets/stylesheets/application_css_scss.html">application.css.scss</a>
  
    <li><a href="../../../app/assets/stylesheets/custom_css_scss.html">custom.css.scss</a>
  
    <li><a href="../../../app/assets/stylesheets/pages_scss.html">pages.scss</a>
  
    <li><a href="../../../config_ru.html">config.ru</a>
  
    <li><a href="../../../log/development_log.html">development.log</a>
  
    <li><a href="../../../node_modules/addressparser/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../../node_modules/addressparser/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/addressparser/README_md.html">README</a>
  
    <li><a href="../../../node_modules/addressparser/lib/addressparser_js.html">addressparser.js</a>
  
    <li><a href="../../../node_modules/addressparser/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_ensureasync/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_ensureasync/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_ensureasync/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_queue/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_queue/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_queue/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_arrayeach/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_arrayeach/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_arrayeach/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_ensureasync/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_ensureasync/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_ensureasync/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_isarray/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_isarray/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_isarray/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_map/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_map/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_map/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_noop/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_noop/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_noop/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_onlyonce/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_onlyonce/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_onlyonce/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_queue/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_queue/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_queue/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_restparam/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_restparam/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_restparam/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/async_util_setimmediate/README_md.html">README</a>
  
    <li><a href="../../../node_modules/async_util_setimmediate/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/async_util_setimmediate/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/bottleneck/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/bottleneck/README_md.html">README</a>
  
    <li><a href="../../../node_modules/bottleneck/bottleneck_d_ts_ejs.html">bottleneck.d.ts.ejs</a>
  
    <li><a href="../../../node_modules/bottleneck/bottleneck_js.html">bottleneck.js</a>
  
    <li><a href="../../../node_modules/bottleneck/bottleneck_min_js.html">bottleneck.min.js</a>
  
    <li><a href="../../../node_modules/bottleneck/bower_json.html">bower.json</a>
  
    <li><a href="../../../node_modules/bottleneck/lib/Bottleneck_js.html">Bottleneck.js</a>
  
    <li><a href="../../../node_modules/bottleneck/lib/Cluster_js.html">Cluster.js</a>
  
    <li><a href="../../../node_modules/bottleneck/lib/DLList_js.html">DLList.js</a>
  
    <li><a href="../../../node_modules/bottleneck/lib/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/bottleneck/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/bottleneck/scripts/build_sh.html">build.sh</a>
  
    <li><a href="../../../node_modules/bottleneck/src/Bottleneck_coffee.html">Bottleneck.coffee</a>
  
    <li><a href="../../../node_modules/bottleneck/src/Cluster_coffee.html">Cluster.coffee</a>
  
    <li><a href="../../../node_modules/bottleneck/src/DLList_coffee.html">DLList.coffee</a>
  
    <li><a href="../../../node_modules/bottleneck/src/index_coffee.html">index.coffee</a>
  
    <li><a href="../../../node_modules/bottleneck/test_ts.html">test.ts</a>
  
    <li><a href="../../../node_modules/bottleneck/test/DLList_js.html">DLList.js</a>
  
    <li><a href="../../../node_modules/bottleneck/test/general_js.html">general.js</a>
  
    <li><a href="../../../node_modules/bottleneck/test/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/bottleneck/test/priority_js.html">priority.js</a>
  
    <li><a href="../../../node_modules/bottleneck/test/promises_js.html">promises.js</a>
  
    <li><a href="../../../node_modules/debug/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../../node_modules/debug/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/debug/Makefile.html">Makefile</a>
  
    <li><a href="../../../node_modules/debug/README_md.html">README</a>
  
    <li><a href="../../../node_modules/debug/component_json.html">component.json</a>
  
    <li><a href="../../../node_modules/debug/karma_conf_js.html">karma.conf.js</a>
  
    <li><a href="../../../node_modules/debug/node_js.html">node.js</a>
  
    <li><a href="../../../node_modules/debug/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/debug/src/browser_js.html">browser.js</a>
  
    <li><a href="../../../node_modules/debug/src/debug_js.html">debug.js</a>
  
    <li><a href="../../../node_modules/debug/src/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/debug/src/node_js.html">node.js</a>
  
    <li><a href="../../../node_modules/encoding/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/encoding/README_md.html">README</a>
  
    <li><a href="../../../node_modules/encoding/lib/encoding_js.html">encoding.js</a>
  
    <li><a href="../../../node_modules/encoding/lib/iconv-loader_js.html">iconv-loader.js</a>
  
    <li><a href="../../../node_modules/encoding/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/encoding/test/test_js.html">test.js</a>
  
    <li><a href="../../../node_modules/extend/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../../node_modules/extend/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/extend/README_md.html">README</a>
  
    <li><a href="../../../node_modules/extend/component_json.html">component.json</a>
  
    <li><a href="../../../node_modules/extend/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/extend/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/Changelog_md.html">Changelog</a>
  
    <li><a href="../../../node_modules/iconv-lite/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/iconv-lite/README_md.html">README</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/dbcs-codec_js.html">dbcs-codec.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/dbcs-data_js.html">dbcs-data.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/internal_js.html">internal.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/sbcs-codec_js.html">sbcs-codec.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/sbcs-data-generated_js.html">sbcs-data-generated.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/sbcs-data_js.html">sbcs-data.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/big5-added_json.html">big5-added.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/cp936_json.html">cp936.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/cp949_json.html">cp949.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/cp950_json.html">cp950.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/eucjp_json.html">eucjp.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/gb18030-ranges_json.html">gb18030-ranges.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/gbk-added_json.html">gbk-added.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/tables/shiftjis_json.html">shiftjis.json</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/utf16_js.html">utf16.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/encodings/utf7_js.html">utf7.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/lib/bom-handling_js.html">bom-handling.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/lib/extend-node_js.html">extend-node.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/lib/index_d_ts.html">index.d.ts</a>
  
    <li><a href="../../../node_modules/iconv-lite/lib/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/lib/streams_js.html">streams.js</a>
  
    <li><a href="../../../node_modules/iconv-lite/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/lodash_chunk/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/lodash_chunk/README_md.html">README</a>
  
    <li><a href="../../../node_modules/lodash_chunk/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/lodash_chunk/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/mailparser/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/mailparser/README_md.html">README</a>
  
    <li><a href="../../../node_modules/mailparser/lib/datetime_js.html">datetime.js</a>
  
    <li><a href="../../../node_modules/mailparser/lib/mailparser_js.html">mailparser.js</a>
  
    <li><a href="../../../node_modules/mailparser/lib/streams_js.html">streams.js</a>
  
    <li><a href="../../../node_modules/mailparser/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/mailparser/test/mailparser_js.html">mailparser.js</a>
  
    <li><a href="../../../node_modules/mailparser/test/mixed_eml.html">mixed.eml</a>
  
    <li><a href="../../../node_modules/mailparser/test/nested_eml.html">nested.eml</a>
  
    <li><a href="../../../node_modules/mime/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/mime/README_md.html">README</a>
  
    <li><a href="../../../node_modules/mime/build/build_js.html">build.js</a>
  
    <li><a href="../../../node_modules/mime/build/test_js.html">test.js</a>
  
    <li><a href="../../../node_modules/mime/cli_js.html">cli.js</a>
  
    <li><a href="../../../node_modules/mime/mime_js.html">mime.js</a>
  
    <li><a href="../../../node_modules/mime/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/mime/types_json.html">types.json</a>
  
    <li><a href="../../../node_modules/mimelib/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/mimelib/README_md.html">README</a>
  
    <li><a href="../../../node_modules/mimelib/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/mimelib/lib/content-types-reversed_js.html">content-types-reversed.js</a>
  
    <li><a href="../../../node_modules/mimelib/lib/content-types_js.html">content-types.js</a>
  
    <li><a href="../../../node_modules/mimelib/lib/mimelib_js.html">mimelib.js</a>
  
    <li><a href="../../../node_modules/mimelib/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/ms/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/ms/license_md.html">license</a>
  
    <li><a href="../../../node_modules/ms/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/ms/readme_md.html">readme</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/CONTRIBUTING_md.html">CONTRIBUTING</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/LICENSE_txt.html">LICENSE</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/README_md.html">README</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/examples/example_js.html">example.js</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/lib/client_js.html">client.js</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/sendgrid-rest/test/test_js.html">test.js</a>
  
    <li><a href="../../../node_modules/sendgrid/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../../node_modules/sendgrid/CONTRIBUTING_md.html">CONTRIBUTING</a>
  
    <li><a href="../../../node_modules/sendgrid/LICENSE_txt.html">LICENSE</a>
  
    <li><a href="../../../node_modules/sendgrid/README_md.html">README</a>
  
    <li><a href="../../../node_modules/sendgrid/TROUBLESHOOTING_md.html">TROUBLESHOOTING</a>
  
    <li><a href="../../../node_modules/sendgrid/USAGE_md.html">USAGE</a>
  
    <li><a href="../../../node_modules/sendgrid/USE_CASES_md.html">USE_CASES</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/accesssettings/accesssettings_js.html">accesssettings.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/alerts/alerts_js.html">alerts.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/apikeys/apikeys_js.html">apikeys.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/asm/asm_js.html">asm.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/browsers/browsers_js.html">browsers.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/campaigns/campaigns_js.html">campaigns.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/categories/categories_js.html">categories.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/clients/clients_js.html">clients.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/contactdb/contactdb_js.html">contactdb.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/devices/devices_js.html">devices.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/geo/geo_js.html">geo.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/helpers/mail/example_js.html">example.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/ips/ips_js.html">ips.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/mail/mail_js.html">mail.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/mailboxproviders/mailboxproviders_js.html">mailboxproviders.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/mailsettings/mailsettings_js.html">mailsettings.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/partnersettings/partnersettings_js.html">partnersettings.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/scopes/scopes_js.html">scopes.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/senders/senders_js.html">senders.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/stats/stats_js.html">stats.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/subusers/subusers_js.html">subusers.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/suppression/suppression_js.html">suppression.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/templates/templates_js.html">templates.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/trackingsettings/trackingsettings_js.html">trackingsettings.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/user/user_js.html">user.js</a>
  
    <li><a href="../../../node_modules/sendgrid/examples/whitelabel/whitelabel_js.html">whitelabel.js</a>
  
    <li><a href="../../../node_modules/sendgrid/index_d_ts.html">index.d.ts</a>
  
    <li><a href="../../../node_modules/sendgrid/index_js.html">index.js</a>
  
    <li><a href="../../../node_modules/sendgrid/lib/helpers/contact-importer/contact-importer_js.html">contact-importer.js</a>
  
    <li><a href="../../../node_modules/sendgrid/lib/helpers/error_js.html">error.js</a>
  
    <li><a href="../../../node_modules/sendgrid/lib/helpers/inbound/parse_js.html">parse.js</a>
  
    <li><a href="../../../node_modules/sendgrid/lib/helpers/mail/README_md.html">README</a>
  
    <li><a href="../../../node_modules/sendgrid/lib/helpers/mail/mail_js.html">mail.js</a>
  
    <li><a href="../../../node_modules/sendgrid/lib/sendgrid_js.html">sendgrid.js</a>
  
    <li><a href="../../../node_modules/sendgrid/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/sendgrid/test/helpers/contact-importer/contact-importer_test_js.html">contact-importer.test.js</a>
  
    <li><a href="../../../node_modules/sendgrid/test/helpers/inbound/parse_test_js.html">parse.test.js</a>
  
    <li><a href="../../../node_modules/sendgrid/test/helpers/mail/test_js.html">test.js</a>
  
    <li><a href="../../../node_modules/sendgrid/test/prism_sh.html">prism.sh</a>
  
    <li><a href="../../../node_modules/sendgrid/test/test_js.html">test.js</a>
  
    <li><a href="../../../node_modules/sendgrid/tsconfig_json.html">tsconfig.json</a>
  
    <li><a href="../../../node_modules/uue/LICENSE.html">LICENSE</a>
  
    <li><a href="../../../node_modules/uue/README_md.html">README</a>
  
    <li><a href="../../../node_modules/uue/package_json.html">package.json</a>
  
    <li><a href="../../../node_modules/uue/uue_js.html">uue.js</a>
  
    <li><a href="../../../package-lock_json.html">package-lock.json</a>
  
    <li><a href="../../../package_json.html">package.json</a>
  
    <li><a href="../../../public/404_html.html">404.html</a>
  
    <li><a href="../../../public/422_html.html">422.html</a>
  
    <li><a href="../../../public/500_html.html">500.html</a>
  
    <li><a href="../../../public/apple-touch-icon-precomposed_png.html">apple-touch-icon-precomposed.png</a>
  
    <li><a href="../../../public/apple-touch-icon_png.html">apple-touch-icon.png</a>
  
    <li><a href="../../../public/favicon_ico.html">favicon.ico</a>
  
    <li><a href="../../../public/robots_txt.html">robots</a>
  
    <li><a href="../../../tmp/pids/server_pid.html">server.pid</a>
  
    <li><a href="../../../tmp/restart_txt.html">restart</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page node_modules/addressparser/lib/addressparser.js">

<p>&#39;use strict&#39;;</p>

<p>// expose to the world module.exports = addressparser;</p>

<pre>Parses structured e-mail addresses from an address field

Example:

   &#39;Name &lt;address@domain&gt;&#39;

will be converted to

    [{name: &#39;Name&#39;, address: &#39;address@domain&#39;}]

@param {String} str Address field
@return {Array} An array of address objects</pre>

<p>function addressparser(str) {</p>

<pre>var tokenizer = new Tokenizer(str);
var tokens = tokenizer.tokenize();

var addresses = [];
var address = [];
var parsedAddresses = [];

tokens.forEach(function (token) {
    if (token.type === &#39;operator&#39; &amp;&amp; (token.value === &#39;,&#39; || token.value === &#39;;&#39;)) {
        if (address.length) {
            addresses.push(address);
        }
        address = [];
    } else {
        address.push(token);
    }
});

if (address.length) {
    addresses.push(address);
}

addresses.forEach(function (address) {
    address = _handleAddress(address);
    if (address.length) {
        parsedAddresses = parsedAddresses.concat(address);
    }
});

return parsedAddresses;</pre>

<p>}</p>

<pre> Converts tokens for a single address into an address object

 @param {Array} tokens Tokens object
 @return {Object} Address object
/</pre>

<p>function _handleAddress(tokens) {</p>

<pre>var token;
var isGroup = false;
var state = &#39;text&#39;;
var address;
var addresses = [];
var data = {
    address: [],
    comment: [],
    group: [],
    text: []
};
var i;
var len;

// Filter out &lt;addresses&gt;, (comments) and regular text
for (i = 0, len = tokens.length; i &lt; len; i++) {
    token = tokens[i];
    if (token.type === &#39;operator&#39;) {
        switch (token.value) {
            case &#39;&lt;&#39;:
                state = &#39;address&#39;;
                break;
            case &#39;(&#39;:
                state = &#39;comment&#39;;
                break;
            case &#39;:&#39;:
                state = &#39;group&#39;;
                isGroup = true;
                break;
            default:
                state = &#39;text&#39;;
        }
    } else if (token.value) {
        if (state === &#39;address&#39;) {
            // handle use case where unquoted name includes a &quot;&lt;&quot;
            // Apple Mail truncates everything between an unexpected &lt; and an address
            // and so will we
            token.value = token.value.replace(/^[^&lt;]*&lt;\s  , &#39;&#39;);
        }
        data[state].push(token.value);
    }
}

// If there is no text but a comment, replace the two
if (!data.text.length &amp;&amp; data.comment.length) {
    data.text = data.comment;
    data.comment = [];
}

if (isGroup) {
    // http://tools.ietf.org/html/rfc2822#appendix-A.1.3
    data.text = data.text.join(&#39; &#39;);
    addresses.push({
        name: data.text || (address &amp;&amp; address.name),
        group: data.group.length ? addressparser(data.group.join(&#39;,&#39;)) : []
    });
} else {
    // If no address was found, try to detect one from regular text
    if (!data.address.length &amp;&amp; data.text.length) {
        for (i = data.text.length - 1; i &gt;= 0; i--) {
            if (data.text[i].match(/^[^@\s]+@[^@\s]+$/)) {
                data.address = data.text.splice(i, 1);
                break;
            }
        }

        var _regexHandler = function (address) {
            if (!data.address.length) {
                data.address = [address.trim()];
                return &#39; &#39;;
            } else {
                return address;
            }
        };

        // still no address
        if (!data.address.length) {
            for (i = data.text.length - 1; i &gt;= 0; i--) {
                // fixed the regex to parse email address correctly when email address has more than one @
                data.text[i] = data.text[i].replace(/\s*\b[^@\s]+@[^\s]+\b\s*/, _regexHandler).trim();
                if (data.address.length) {
                    break;
                }
            }
        }
    }

    // If there&#39;s still is no text but a comment exixts, replace the two
    if (!data.text.length &amp;&amp; data.comment.length) {
        data.text = data.comment;
        data.comment = [];
    }

    // Keep only the first address occurence, push others to regular text
    if (data.address.length &gt; 1) {
        data.text = data.text.concat(data.address.splice(1));
    }

    // Join values with spaces
    data.text = data.text.join(&#39; &#39;);
    data.address = data.address.join(&#39; &#39;);

    if (!data.address &amp;&amp; isGroup) {
        return [];
    } else {
        address = {
            address: data.address || data.text || &#39;&#39;,
            name: data.text || data.address || &#39;&#39;
        };

        if (address.address === address.name) {
            if ((address.address || &#39;&#39;).match(/@/)) {
                address.name = &#39;&#39;;
            } else {
                address.address = &#39;&#39;;
            }

        }

        addresses.push(address);
    }
}

return addresses;</pre>

<p>}</p>

<p>/**</p>

<pre> Creates a Tokenizer object for tokenizing address field strings

 @constructor
 @param {String} str Address field string
/</pre>

<p>function Tokenizer(str) {</p>

<pre class="ruby"><span class="ruby-identifier">this</span>.<span class="ruby-identifier">str</span> = (<span class="ruby-identifier">str</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>).<span class="ruby-identifier">toString</span>();
<span class="ruby-identifier">this</span>.<span class="ruby-identifier">operatorCurrent</span> = <span class="ruby-string">&#39;&#39;</span>;
<span class="ruby-identifier">this</span>.<span class="ruby-identifier">operatorExpecting</span> = <span class="ruby-string">&#39;&#39;</span>;
<span class="ruby-identifier">this</span>.<span class="ruby-identifier">node</span> = <span class="ruby-identifier">null</span>;
<span class="ruby-identifier">this</span>.<span class="ruby-identifier">escaped</span> = <span class="ruby-keyword">false</span>;

<span class="ruby-identifier">this</span>.<span class="ruby-identifier">list</span> = [];
</pre>

<p>}</p>

<p>/**</p>

<pre> Operator tokens and which tokens are expected to end the sequence
/</pre>

<p>Tokenizer.prototype.operators = {</p>

<pre>&#39;&quot;&#39;: &#39;&quot;&#39;,
&#39;(&#39;: &#39;)&#39;,
&#39;&lt;&#39;: &#39;&gt;&#39;,
&#39;,&#39;: &#39;&#39;,
&#39;:&#39;: &#39;;&#39;,
// Semicolons are not a legal delimiter per the RFC2822 grammar other
// than for terminating a group, but they are also not valid for any
// other use in this context.  Given that some mail clients have
// historically allowed the semicolon as a delimiter equivalent to the
// comma in their UI, it makes sense to treat them the same as a comma
// when used outside of a group.
&#39;;&#39;: &#39;&#39;</pre>

<p>};</p>

<p>/**</p>

<pre> Tokenizes the original input string

 @return {Array} An array of operator|text tokens
/</pre>

<p>Tokenizer.prototype.tokenize = function () {</p>

<pre>var chr, list = [];
for (var i = 0, len = this.str.length; i &lt; len; i++) {
    chr = this.str.charAt(i);
    this.checkChar(chr);
}

this.list.forEach(function (node) {
    node.value = (node.value || &#39;&#39;).toString().trim();
    if (node.value) {
        list.push(node);
    }
});

return list;</pre>

<p>};</p>

<p>/**</p>

<pre> Checks if a character is an operator or text and acts accordingly

 @param {String} chr Character from the address field
/</pre>

<p>Tokenizer.prototype.checkChar = function (chr) {</p>

<pre>if ((chr in this.operators || chr === &#39;\\&#39;) &amp;&amp; this.escaped) {
    this.escaped = false;
} else if (this.operatorExpecting &amp;&amp; chr === this.operatorExpecting) {
    this.node = {
        type: &#39;operator&#39;,
        value: chr
    };
    this.list.push(this.node);
    this.node = null;
    this.operatorExpecting = &#39;&#39;;
    this.escaped = false;
    return;
} else if (!this.operatorExpecting &amp;&amp; chr in this.operators) {
    this.node = {
        type: &#39;operator&#39;,
        value: chr
    };
    this.list.push(this.node);
    this.node = null;
    this.operatorExpecting = this.operators[chr];
    this.escaped = false;
    return;
}

if (!this.escaped &amp;&amp; chr === &#39;\\&#39;) {
    this.escaped = true;
    return;
}

if (!this.node) {
    this.node = {
        type: &#39;text&#39;,
        value: &#39;&#39;
    };
    this.list.push(this.node);
}

if (this.escaped &amp;&amp; chr !== &#39;\\&#39;) {
    this.node.value += &#39;\\&#39;;
}

this.node.value += chr;
this.escaped = false;</pre>

<p>};</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://rdoc.github.io/rdoc">RDoc</a> 5.0.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

